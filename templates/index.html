<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITAM - IT 자산관리 시스템</title>
    <link rel="icon"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect x='6' y='6' width='52' height='52' rx='12' fill='%232563EB'/%3E%3Cpath d='M20 23h24a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H20a2 2 0 0 1-2-2V25a2 2 0 0 1 2-2z' fill='white'/%3E%3Cpath d='M24 19h16v6H24z' fill='%23DBEAFE'/%3E%3C/svg%3E">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #334155;
            --primary-dark: #0f172a;
            --primary-light: #f1f5f9;
            --success: #15803d;
            --success-light: #f0fdf4;
            --warning: #b45309;
            --warning-light: #fffbeb;
            --danger: #b91c1c;
            --danger-light: #fef2f2;
            --info: #0e7490;
            --info-light: #ecfeff;
            --gray-50: #F8FAFC;
            --gray-100: #F1F5F9;
            --gray-200: #E2E8F0;
            --gray-300: #CBD5E1;
            --gray-400: #94A3B8;
            --gray-500: #64748B;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1E293B;
            --gray-900: #0F172A;
            --sidebar-width: 240px;
            --radius: 8px;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07), 0 2px 4px rgba(0, 0, 0, 0.05);
            --focus-ring: #334155;
            --focus-ring-soft: rgba(51, 65, 85, 0.18);
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--gray-100);
            min-height: 100vh;
            color: var(--gray-900);
            line-height: 1.5;
            text-rendering: optimizeLegibility;
        }

        /* Layout */
        .app {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: var(--sidebar-width);
            background: var(--gray-900);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .main {
            margin-left: var(--sidebar-width);
            flex: 1;
            padding: 24px;
        }

        /* Sidebar */
        .logo {
            padding: 20px;
            font-size: 1.5rem;
            font-weight: 700;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo span {
            color: var(--primary);
        }

        .nav-section {
            padding: 16px 0;
        }

        .nav-section-title {
            padding: 8px 20px;
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--gray-300);
        }

        .nav-item {
            display: flex;
            align-items: center;
            min-height: 44px;
            width: 100%;
            padding: 12px 20px;
            color: var(--gray-300);
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            background: transparent;
            border: none;
            font: inherit;
            text-align: left;
            border-radius: 0 10px 10px 0;
            margin-right: 8px;
            user-select: none;
        }

        .nav-item:hover,
        .nav-item.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .nav-item.active {
            border-left: 3px solid var(--primary);
        }

        .nav-item:focus-visible {
            color: white;
            background: rgba(255, 255, 255, 0.16);
            outline: 2px solid var(--focus-ring);
            outline-offset: 2px;
        }

        .nav-item i {
            width: 24px;
            margin-right: 12px;
        }

        .nav-icon {
            width: 24px;
            margin-right: 12px;
            text-align: center;
            flex-shrink: 0;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .header h1 {
            font-size: 1.75rem;
            color: var(--gray-800);
        }

        .header-date {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            color: var(--gray-600);
            background: white;
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid var(--gray-200);
            box-shadow: var(--shadow-sm);
        }



        .header-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: flex-end;
        }

        .page-toolbar {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn-soft {
            background: #fff;
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
        }

        .btn-soft:hover {
            background: var(--gray-100);
            border-color: var(--gray-400);
        }

        /* Cards */
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--gray-200);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0, 0, 0, 0.08);
            border-color: var(--gray-300);
        }

        @media (prefers-reduced-motion: reduce) {
            .card {
                transition: box-shadow 0.2s ease;
            }

            .card:hover {
                transform: none;
            }
        }

        .card-title {
            font-size: 0.8125rem;
            color: var(--gray-600);
            margin-bottom: 12px;
            font-weight: 500;
            letter-spacing: 0.01em;
            text-wrap: balance;
            line-height: 1.3;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .card-value {
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--gray-800);
            line-height: 1.1;
            font-variant-numeric: tabular-nums;
            letter-spacing: -0.02em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .card-value.success {
            color: var(--success);
        }

        .card-value.warning {
            color: var(--warning);
        }

        .card-value.danger {
            color: var(--danger);
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
            min-height: 42px;
            line-height: 1.15;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
        }

        .btn-secondary:hover {
            background: var(--gray-200);
            border-color: var(--gray-400);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #B91C1C;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-warning {
            background: var(--warning);
            color: #fff;
        }

        .btn-warning:hover {
            background: #B45309;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-outline-primary {
            background: #fff;
            color: var(--primary-dark);
            border: 1px solid #93C5FD;
        }

        .btn-outline-primary:hover {
            background: #EFF6FF;
            border-color: #60A5FA;
        }

        .btn:disabled {
            opacity: 0.58;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.875rem;
            min-height: 34px;
        }

        .action-group {
            display: inline-flex;
            gap: 7px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn-action {
            border-radius: 999px;
            font-weight: 600;
            letter-spacing: 0.01em;
            gap: 6px;
            transition: all 0.18s;
            box-shadow: none;
        }

        .btn-action:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 12px rgba(15, 23, 42, 0.12);
        }

        .btn-action:active {
            transform: translateY(0);
            box-shadow: none;
        }

        .btn-action-primary {
            background: #EEF2FF;
            color: #1E3A8A;
            border: 1px solid #C7D2FE;
        }

        .btn-action-primary:hover {
            background: #DBEAFE;
            border-color: #93C5FD;
        }

        .btn-action-secondary {
            background: #FFFFFF;
            color: #334155;
            border: 1px solid var(--gray-300);
        }

        .btn-action-secondary:hover {
            background: #F8FAFC;
            border-color: #94A3B8;
        }

        .btn-action-danger {
            background: #FEF2F2;
            color: #991B1B;
            border: 1px solid #FECACA;
        }

        .btn-action-danger:hover {
            background: #FEE2E2;
            border-color: #FCA5A5;
            color: #7F1D1D;
        }

        .btn-icon {
            font-size: 0.82rem;
            line-height: 1;
        }

        /* Tables */
        .table-container {
            background: white;
            border-radius: 12px;
            overflow: auto;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            -webkit-overflow-scrolling: touch;
        }

        .management-page .control-panel {
            background: #F8FAFC;
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 14px;
            box-shadow: var(--shadow-sm);
        }

        .management-page .control-panel .header {
            margin-bottom: 0;
        }

        .management-page .control-panel .header+.filters {
            margin-top: 12px;
        }

        .management-page .table-container {
            border: 1px solid var(--gray-200);
            box-shadow: var(--shadow-sm);
        }

        .table-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        .management-page table {
            min-width: 920px;
        }

        th,
        td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
            font-size: 0.9rem;
            vertical-align: middle;
        }

        .index-col {
            width: 56px;
            text-align: center;
            color: var(--gray-600);
        }

        th {
            background: var(--gray-800);
            font-weight: 700;
            color: white;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            border-bottom: 2px solid var(--primary);
            white-space: nowrap;
        }

        tbody tr {
            transition: background 0.15s ease;
        }

        tbody tr:hover {
            background: var(--primary-light);
        }

        .table-link-btn {
            border: none;
            background: transparent;
            color: var(--primary-dark);
            font: inherit;
            font-weight: 600;
            padding: 0;
            cursor: pointer;
            text-align: left;
        }

        .table-link-btn:hover {
            color: var(--primary);
            text-decoration: underline;
        }

        /* Forms */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--gray-700);
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            color: var(--gray-900);
            transition: border-color 0.18s ease, box-shadow 0.18s ease;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--focus-ring-soft);
        }

        .form-input::placeholder,
        .search-input::placeholder {
            color: var(--gray-500);
        }

        .form-input[readonly] {
            background: var(--gray-100);
            color: var(--gray-600);
        }

        .compact-form {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 16px 20px;
        }

        .form-group-full {
            grid-column: 1 / -1;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.25rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-600);
            min-width: 40px;
            min-height: 40px;
            border-radius: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: background 0.15s ease, color 0.15s ease;
        }

        .modal-close:hover {
            background: var(--gray-100);
            color: var(--gray-800);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Status Badge */
        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-success {
            background: #D1FAE5;
            color: #065F46;
        }

        .badge-warning {
            background: #FEF3C7;
            color: #92400E;
        }

        .badge-danger {
            background: #FEE2E2;
            color: #991B1B;
        }

        .badge-info {
            background: #DBEAFE;
            color: #1E40AF;
        }

        /* Charts */
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .chart-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--gray-800);
        }

        /* Grid */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        /* License Gauge */
        .license-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--gray-100);
        }

        .license-bar {
            width: 150px;
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
        }

        .license-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s;
        }

        /* Activity Feed */
        .activity-item {
            padding: 12px 0;
            border-bottom: 1px solid var(--gray-100);
        }

        .activity-time {
            font-size: 0.75rem;
            color: var(--gray-600);
        }

        .activity-text {
            font-size: 0.875rem;
            color: var(--gray-800);
            margin-top: 4px;
        }

        /* Search & Filter */
        .filters {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
            align-items: center;
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 10px;
            padding: 10px;
        }

        .search-input {
            padding: 10px 14px;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            min-width: 250px;
            font-size: 1rem;
            min-height: 42px;
            color: var(--gray-900);
            transition: border-color 0.18s ease, box-shadow 0.18s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--focus-ring-soft);
        }

        .filter-search {
            flex: 1 1 320px;
            max-width: 420px;
        }

        .filter-select {
            width: 170px;
        }

        .filter-select-wide {
            width: 220px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-200);
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: var(--gray-600);
            border-top: none;
            border-left: none;
            border-right: none;
            background: transparent;
            font: inherit;
        }

        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            font-weight: 600;
        }

        :where(.btn, .btn-action, .nav-item, .tab, .modal-close, .form-input, .form-select, .search-input, .table-link-btn):focus-visible {
            outline: 2px solid var(--focus-ring);
            outline-offset: 2px;
        }

        /* Page sections */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Manual Page */
        .manual-page {
            display: grid;
            gap: 16px;
        }

        .manual-hero {
            background: var(--gray-900);
            color: white;
            border-radius: 16px;
            padding: 28px;
            box-shadow: var(--shadow-md);
        }

        .manual-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 255, 255, 0.16);
            border: 1px solid rgba(255, 255, 255, 0.24);
            border-radius: 999px;
            padding: 6px 12px;
            font-size: 0.8rem;
            margin-bottom: 14px;
        }

        .manual-hero h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            letter-spacing: -0.01em;
        }

        .manual-hero p {
            color: #DBEAFE;
            line-height: 1.6;
            max-width: 760px;
        }

        .manual-section {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 18px;
            box-shadow: var(--shadow-sm);
        }

        .manual-title {
            font-size: 1.05rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 10px;
        }

        .manual-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 12px;
        }

        .manual-card {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 16px;
            box-shadow: var(--shadow-sm);
        }

        .manual-card h3 {
            font-size: 1rem;
            color: var(--gray-800);
            margin-bottom: 8px;
        }

        .manual-card p {
            color: var(--gray-600);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .manual-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .manual-chip {
            background: var(--gray-100);
            border: 1px solid var(--gray-200);
            color: var(--gray-700);
            border-radius: 999px;
            padding: 6px 12px;
            font-size: 0.82rem;
            font-weight: 600;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0;
            border-bottom: 2px solid var(--gray-200);
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            color: var(--gray-600);
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
            border-top: none;
            border-left: none;
            border-right: none;
            background: transparent;
            font: inherit;
        }

        .tab:hover {
            color: var(--primary);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            font-weight: 600;
        }

        .tab:focus-visible {
            color: var(--primary);
            background: rgba(37, 99, 235, 0.08);
            border-radius: 8px 8px 0 0;
        }

        /* Detail Info Grid */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px 24px;
        }

        .info-item {
            padding: 8px 0;
            border-bottom: 1px solid var(--gray-100);
        }

        .info-label {
            font-size: 0.85rem;
            color: var(--gray-500);
            margin-bottom: 4px;
        }

        .info-value {
            font-weight: 500;
            color: var(--gray-800);
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 24px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--gray-200);
        }

        .timeline-item {
            position: relative;
            padding: 12px 0 12px 16px;
            border-bottom: none;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -20px;
            top: 16px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
            border: 2px solid white;
            z-index: 1;
        }

        .timeline-date {
            font-size: 0.75rem;
            color: var(--gray-500);
        }

        .timeline-action {
            font-weight: 500;
            color: var(--gray-800);
            margin-top: 4px;
        }

        .timeline-detail {
            font-size: 0.85rem;
            color: var(--gray-600);
            margin-top: 2px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main {
                margin-left: 60px;
                padding: 16px;
            }

            .header {
                align-items: flex-start;
                flex-direction: column;
                gap: 10px;
            }

            .header-actions {
                width: 100%;
                justify-content: flex-start;
            }

            .page-toolbar {
                width: 100%;
            }

            .page-toolbar .btn {
                flex: 1 1 auto;
            }

            .compact-form {
                grid-template-columns: 1fr;
            }

            .filter-search,
            .filter-select,
            .filter-select-wide {
                width: 100%;
                max-width: none;
            }

            .sidebar {
                width: 60px;
            }

            .sidebar .nav-item .nav-label,
            .sidebar .nav-section-title,
            .sidebar .logo span {
                display: none;
            }

            .sidebar .nav-item {
                justify-content: center;
                margin-right: 6px;
                padding: 10px;
            }

            .grid-2 {
                grid-template-columns: 1fr;
            }

            .cards {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
                gap: 12px;
            }

            .card-value {
                font-size: 1.875rem;
            }

            .manual-grid {
                grid-template-columns: 1fr;
            }

            .manual-hero h2 {
                font-size: 1.7rem;
            }
        }

        @media (max-width: 480px) {
            .main {
                padding: 12px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .header-date {
                width: 100%;
                justify-content: center;
            }

            .table-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .modal {
                width: 95%;
            }

            .cards {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .card-value {
                font-size: 1.5rem;
            }
        }

        @media (prefers-reduced-motion: reduce) {

            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            flex-shrink: 0;
        }
    </style>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>
    <div class="app">
        <!-- Sidebar Navigation -->
        <!-- 관리 화면은 data-page 라우팅 기반의 단일 페이지 구조로 구성 -->
        <nav class="sidebar">
            <div class="logo"><i data-lucide="layers"
                    style="width:22px;height:22px;display:inline-block;vertical-align:middle;margin-right:6px"></i>
                <span>ITAM</span>
            </div>
            <div class="nav-section">
                <button type="button" class="nav-item active" data-page="dashboard" aria-current="page">
                    <i data-lucide="layout-dashboard" class="nav-icon" aria-hidden="true"></i><span
                        class="nav-label">대시보드</span>
                </button>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">자산관리</div>
                <button type="button" class="nav-item" data-page="assets">
                    <i data-lucide="monitor" class="nav-icon" aria-hidden="true"></i><span class="nav-label">HW
                        자산</span>
                </button>
                <button type="button" class="nav-item" data-page="licenses">
                    <i data-lucide="file-text" class="nav-icon" aria-hidden="true"></i><span class="nav-label">SW
                        라이선스</span>
                </button>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">기준정보</div>
                <button type="button" class="nav-item" data-page="locations">
                    <i data-lucide="building-2" class="nav-icon" aria-hidden="true"></i><span
                        class="nav-label">사업장</span>
                </button>
                <button type="button" class="nav-item" data-page="departments">
                    <i data-lucide="network" class="nav-icon" aria-hidden="true"></i><span class="nav-label">부서</span>
                </button>
                <button type="button" class="nav-item" data-page="users">
                    <i data-lucide="users" class="nav-icon" aria-hidden="true"></i><span class="nav-label">사용자</span>
                </button>
                <button type="button" class="nav-item" data-page="categories">
                    <i data-lucide="folder-tree" class="nav-icon" aria-hidden="true"></i><span
                        class="nav-label">카테고리</span>
                </button>
                <button type="button" class="nav-item" data-page="vendors">
                    <i data-lucide="building" class="nav-icon" aria-hidden="true"></i><span
                        class="nav-label">공급업체</span>
                </button>
                <button type="button" class="nav-item" data-page="eos">
                    <i data-lucide="clock" class="nav-icon" aria-hidden="true"></i><span class="nav-label">EOS 정보</span>
                </button>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">관리</div>
                <button type="button" class="nav-item" data-page="inventories">
                    <i data-lucide="clipboard-list" class="nav-icon" aria-hidden="true"></i><span
                        class="nav-label">실사관리</span>
                </button>
                <button type="button" class="nav-item" data-page="notifications">
                    <i data-lucide="bell" class="nav-icon" aria-hidden="true"></i><span class="nav-label">알림</span>
                </button>
                <button type="button" class="nav-item" data-page="manual">
                    <i data-lucide="book-open" class="nav-icon" aria-hidden="true"></i><span
                        class="nav-label">설명서</span>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <!-- 페이지 섹션은 .page 요소 집합이며 active class 토글로 화면 전환 -->
        <main class="main">
            <!-- Dashboard Page -->
            <div id="page-dashboard" class="page active">
                <div class="header">
                    <h1>대시보드</h1>
                    <div class="header-date" id="currentDate"></div>
                </div>
                <div class="cards" id="summary-cards"></div>
                <div class="grid-2">
                    <div class="chart-container">
                        <div class="chart-title">카테고리별 자산 현황</div>
                        <canvas id="categoryChart" height="200"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">라이선스 현황</div>
                        <div id="licenseStatus"></div>
                    </div>
                </div>
                <div class="grid-2">
                    <div class="chart-container">
                        <div class="chart-title"><i data-lucide="alert-triangle"
                                style="width:16px;height:16px;display:inline-block;vertical-align:middle;margin-right:4px;color:var(--warning)"></i>
                            사용연한 초과</div>
                        <div id="usefulLifeExpired"></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title"><i data-lucide="clock"
                                style="width:16px;height:16px;display:inline-block;vertical-align:middle;margin-right:4px;color:var(--danger)"></i>
                            OS EOS 현황</div>
                        <div id="eosStatus"></div>
                    </div>
                </div>
                <div class="grid-2">
                    <div class="chart-container">
                        <div class="chart-title"><i data-lucide="building-2"
                                style="width:16px;height:16px;display:inline-block;vertical-align:middle;margin-right:4px;color:var(--gray-600)"></i>
                            사업장별 자산 현황</div>
                        <canvas id="locationChart" height="180"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title"><i data-lucide="users"
                                style="width:16px;height:16px;display:inline-block;vertical-align:middle;margin-right:4px;color:var(--gray-600)"></i>
                            부서별 자산 현황</div>
                        <canvas id="departmentChart" height="180"></canvas>
                    </div>
                </div>
                <div class="chart-container" style="margin-top:20px">
                    <div class="chart-title">최근 활동</div>
                    <div id="recentActivity"></div>
                </div>
            </div>

            <!-- Assets Page -->
            <div id="page-assets" class="page management-page">
                <div class="control-panel">
                    <div class="header">
                        <h1>HW 자산 관리</h1>
                        <div class="header-actions">
                            <div class="page-toolbar">
                                <button class="btn btn-soft" onclick="downloadTemplate('hw')"><i data-lucide="download"
                                        style="width:15px;height:15px;display:inline-block;vertical-align:middle;margin-right:3px"></i>
                                    템플릿</button>
                                <button class="btn btn-soft" onclick="openImportModal('asset')"><i data-lucide="upload"
                                        style="width:15px;height:15px;display:inline-block;vertical-align:middle;margin-right:3px"></i>
                                    Import</button>
                                <button class="btn btn-soft" onclick="exportAssets()"><i data-lucide="file-output"
                                        style="width:15px;height:15px;display:inline-block;vertical-align:middle;margin-right:3px"></i>
                                    Export</button>
                            </div>
                            <div class="page-toolbar">
                                <button class="btn btn-primary" onclick="openAssetModal()">+ 자산 등록</button>
                            </div>
                        </div>
                    </div>
                    <div class="filters">
                        <input type="text" class="search-input filter-search" id="assetSearch"
                            placeholder="자산번호, 자산명, 시리얼 검색..." aria-label="HW 자산 검색" onkeyup="loadAssets()">
                        <select class="form-select filter-select" id="assetLocationFilter" aria-label="HW 사업장 필터"
                            onchange="loadAssets()">
                            <option value="">전체 사업장</option>
                        </select>
                        <select class="form-select filter-select" id="assetStatusFilter" aria-label="HW 상태 필터"
                            onchange="loadAssets()">
                            <option value="">전체 상태</option>
                            <option value="사용중">사용중</option>
                            <option value="여유">여유</option>
                            <option value="수리중">수리중</option>
                            <option value="폐기예정">폐기예정</option>
                        </select>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="index-col">번호</th>
                                <th>자산번호</th>
                                <th>자산명</th>
                                <th>카테고리</th>
                                <th>상태</th>
                                <th>사업장</th>
                                <th>사용자</th>
                                <th>관리</th>
                            </tr>
                        </thead>
                        <tbody id="assetsTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Licenses Page -->
            <div id="page-licenses" class="page management-page">
                <div class="control-panel">
                    <div class="header">
                        <h1>SW 라이선스 관리</h1>
                        <div class="header-actions">
                            <div class="page-toolbar">
                                <button class="btn btn-soft" onclick="downloadTemplate('license')"><i
                                        data-lucide="download"
                                        style="width:15px;height:15px;display:inline-block;vertical-align:middle;margin-right:3px"></i>
                                    템플릿</button>
                                <button class="btn btn-soft" onclick="openImportModal('license')"><i
                                        data-lucide="upload"
                                        style="width:15px;height:15px;display:inline-block;vertical-align:middle;margin-right:3px"></i>
                                    Import</button>
                                <button class="btn btn-soft" onclick="exportLicenses()"><i data-lucide="file-output"
                                        style="width:15px;height:15px;display:inline-block;vertical-align:middle;margin-right:3px"></i>
                                    Export</button>
                            </div>
                            <div class="page-toolbar">
                                <button class="btn btn-primary" onclick="openLicenseModal()">+ 라이선스 등록</button>
                            </div>
                        </div>
                    </div>
                    <div class="filters">
                        <input type="text" class="search-input filter-search" id="licenseSearch"
                            placeholder="라이선스번호, 소프트웨어명, 공급사 검색..." aria-label="SW 라이선스 검색" onkeyup="loadLicenses()">
                        <select class="form-select filter-select" id="licenseVendorFilter" aria-label="SW 공급사 필터"
                            onchange="loadLicenses()">
                            <option value="">전체 공급사</option>
                        </select>
                        <select class="form-select filter-select" id="licenseUsedFilter" aria-label="SW 사용여부 필터"
                            onchange="loadLicenses()">
                            <option value="">전체 사용여부</option>
                            <option value="used">사용중</option>
                            <option value="unused">미사용</option>
                        </select>
                        <select class="form-select filter-select" id="licenseListFilter" aria-label="SW 상태 필터"
                            onchange="loadLicenses()">
                            <option value="" selected>전체 상태</option>
                            <option value="활성">활성</option>
                            <option value="만료예정">만료예정</option>
                            <option value="만료">만료</option>
                            <option value="해지">해지</option>
                        </select>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="index-col">번호</th>
                                <th>관리번호</th>
                                <th>소프트웨어명</th>
                                <th>유형</th>
                                <th>총수량</th>
                                <th>사용</th>
                                <th>가용</th>
                                <th>상태</th>
                                <th>관리</th>
                            </tr>
                        </thead>
                        <tbody id="licensesTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Locations Page -->
            <div id="page-locations" class="page management-page">
                <div class="control-panel">
                    <div class="header">
                        <h1>사업장 관리</h1>
                        <button class="btn btn-primary" onclick="openLocationModal()">+ 사업장 등록</button>
                    </div>
                    <div class="filters">
                        <input type="text" class="search-input filter-search" id="locationSearch"
                            placeholder="코드, 사업장명, 주소, 건물 검색..." aria-label="사업장 검색" oninput="debouncedLoadLocations()">
                        <select class="form-select filter-select" id="locationBuildingFilter" aria-label="사업장 건물 필터"
                            onchange="loadLocations()">
                            <option value="">전체 건물정보</option>
                            <option value="has">건물 있음</option>
                            <option value="none">건물 없음</option>
                        </select>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="index-col">번호</th>
                                <th>코드</th>
                                <th>사업장명</th>
                                <th>주소</th>
                                <th>건물</th>
                                <th>관리</th>
                            </tr>
                        </thead>
                        <tbody id="locationsTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Departments Page -->
            <div id="page-departments" class="page management-page">
                <div class="control-panel">
                    <div class="header">
                        <h1>부서 관리</h1>
                        <button class="btn btn-primary" onclick="openDeptModal()">+ 부서 등록</button>
                    </div>
                    <div class="filters">
                        <input type="text" class="search-input filter-search" id="departmentSearch"
                            placeholder="코드, 부서명 검색..." aria-label="부서 검색" oninput="debouncedLoadDepartments()">
                        <select class="form-select filter-select" id="departmentLocationFilter" aria-label="부서 사업장 필터"
                            onchange="loadDepartments()">
                            <option value="">전체 사업장</option>
                        </select>
                        <select class="form-select filter-select" id="departmentLevelFilter" aria-label="부서 레벨 필터"
                            onchange="loadDepartments()">
                            <option value="">전체 레벨</option>
                            <option value="1">레벨 1</option>
                            <option value="2">레벨 2</option>
                            <option value="3">레벨 3</option>
                        </select>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="index-col">번호</th>
                                <th>코드</th>
                                <th>부서명</th>
                                <th>레벨</th>
                                <th>사업장</th>
                                <th>관리</th>
                            </tr>
                        </thead>
                        <tbody id="departmentsTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Users Page -->
            <div id="page-users" class="page management-page">
                <div class="control-panel">
                    <div class="header">
                        <h1>사용자 관리</h1>
                        <button class="btn btn-primary" onclick="openUserModal()">+ 사용자 등록</button>
                    </div>
                    <div class="filters">
                        <input type="text" class="search-input filter-search" id="userSearch"
                            placeholder="사번, 이름, 이메일 검색..." aria-label="사용자 검색" oninput="debouncedLoadUsers()">
                        <select class="form-select filter-select" id="userLocationFilter" aria-label="사용자 사업장 필터"
                            onchange="loadUsers()">
                            <option value="">전체 사업장</option>
                        </select>
                        <select class="form-select filter-select" id="userStatusFilter" aria-label="사용자 재직 상태 필터"
                            onchange="loadUsers()">
                            <option value="">전체 상태</option>
                            <option value="active">재직</option>
                            <option value="inactive">퇴직</option>
                        </select>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="index-col">번호</th>
                                <th>사번</th>
                                <th>이름</th>
                                <th>이메일</th>
                                <th>부서</th>
                                <th>사업장</th>
                                <th>상태</th>
                                <th>관리</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Categories Page -->
            <div id="page-categories" class="page management-page">
                <div class="control-panel">
                    <div class="header">
                        <h1>카테고리 관리</h1>
                        <button class="btn btn-primary" onclick="openCategoryModal()">+ 카테고리 등록</button>
                    </div>
                    <div class="filters">
                        <input type="text" class="search-input filter-search" id="categorySearch"
                            placeholder="코드, 카테고리명 검색..." aria-label="카테고리 검색" oninput="debouncedLoadCategories()">
                        <select class="form-select filter-select" id="categoryTypeFilter" aria-label="카테고리 자산유형 필터"
                            onchange="loadCategories()">
                            <option value="">전체 유형</option>
                            <option value="HW">HW</option>
                            <option value="SW">SW</option>
                        </select>
                        <select class="form-select filter-select" id="categoryLevelFilter" aria-label="카테고리 레벨 필터"
                            onchange="loadCategories()">
                            <option value="">전체 레벨</option>
                            <option value="1">레벨 1</option>
                            <option value="2">레벨 2</option>
                            <option value="3">레벨 3</option>
                        </select>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="index-col">번호</th>
                                <th>코드</th>
                                <th>카테고리명</th>
                                <th>레벨</th>
                                <th>자산유형</th>
                                <th>상위 카테고리</th>
                                <th>사용연한(월)</th>
                                <th>관리</th>
                            </tr>
                        </thead>
                        <tbody id="categoriesTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Vendors Page -->
            <div id="page-vendors" class="page management-page">
                <div class="control-panel">
                    <div class="header">
                        <h1>공급업체 관리</h1>
                        <button class="btn btn-primary" onclick="openVendorModal()">+ 공급업체 등록</button>
                    </div>
                    <div class="filters">
                        <input type="text" class="search-input filter-search" id="vendorSearch"
                            placeholder="업체명, 담당자, 연락처, 이메일 검색..." aria-label="공급업체 검색"
                            oninput="debouncedLoadVendors()">
                        <select class="form-select filter-select" id="vendorTypeFilter" aria-label="공급업체 유형 필터"
                            onchange="loadVendors()">
                            <option value="">전체 구분</option>
                            <option value="제조사">제조사</option>
                            <option value="판매사">판매사</option>
                            <option value="유지보수">유지보수</option>
                            <option value="종합">종합</option>
                        </select>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="index-col">번호</th>
                                <th>업체명</th>
                                <th>구분</th>
                                <th>담당자</th>
                                <th>연락처</th>
                                <th>이메일</th>
                                <th>관리</th>
                            </tr>
                        </thead>
                        <tbody id="vendorsTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- EOS Page -->
            <div id="page-eos" class="page management-page">
                <div class="control-panel">
                    <div class="header">
                        <h1>EOS 정보 관리</h1>
                        <button class="btn btn-primary" onclick="openEOSModal()">+ EOS 등록</button>
                    </div>
                    <div class="filters">
                        <input type="text" class="search-input filter-search" id="eosSearch"
                            placeholder="제품명, 버전, 제조사 검색..." aria-label="EOS 검색" oninput="debouncedLoadEOS()">
                        <select class="form-select filter-select" id="eosTypeFilter" aria-label="EOS 유형 필터"
                            onchange="loadEOS()">
                            <option value="">전체 유형</option>
                        </select>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="index-col">번호</th>
                                <th>제품명</th>
                                <th>버전</th>
                                <th>유형</th>
                                <th>제조사</th>
                                <th>EOS 날짜</th>
                                <th>비고</th>
                                <th>관리</th>
                            </tr>
                        </thead>
                        <tbody id="eosTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Inventories Page -->
            <div id="page-inventories" class="page">
                <div class="header">
                    <h1>실사 관리</h1>
                    <button class="btn btn-primary" onclick="openInventoryModal()">+ 실사 일정 등록</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>실사명</th>
                                <th>유형</th>
                                <th>기간</th>
                                <th>담당자</th>
                                <th>상태</th>
                            </tr>
                        </thead>
                        <tbody id="inventoriesTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Notifications Page -->
            <div id="page-notifications" class="page">
                <div class="header">
                    <h1>알림 센터</h1>
                    <button class="btn btn-secondary" onclick="readAllNotifications()">모두 읽음</button>
                </div>
                <div class="table-container">
                    <div id="notificationsList" style="padding:20px"></div>
                </div>
            </div>

            <!-- Manual Page -->
            <div id="page-manual" class="page">
                <div class="manual-page">
                    <section class="manual-hero">
                        <div class="manual-badge">Manufacturing DX Team</div>
                        <h2>복잡한 자산 관리, 이제 심플하게.</h2>
                        <p>
                            IT 자산 운영의 핵심 데이터를 한 화면에서 관리하고, 실무자가 빠르게 판단할 수 있도록 설계한
                            내부 전용 IT Asset Management System입니다.
                        </p>
                    </section>

                    <section class="manual-section">
                        <div class="manual-title">Why It Exists</div>
                        <p style="color:var(--gray-600);line-height:1.6;margin-bottom:12px;">
                            분산된 엑셀/메일 기반 운영에서 발생하던 누락, 중복, 이력 추적 문제를 줄이고
                            자산·라이선스의 수명주기를 표준화하기 위해 구축되었습니다.
                        </p>
                        <div class="manual-chips">
                            <span class="manual-chip">운영 표준화</span>
                            <span class="manual-chip">추적 가능성</span>
                            <span class="manual-chip">감사 대응력</span>
                        </div>
                    </section>

                    <section class="manual-grid">
                        <article class="manual-card">
                            <h3>Asset Management</h3>
                            <p>HW 등록, 상태 변경, 사용자 배정, 변경이력까지 한 흐름으로 관리합니다.</p>
                        </article>
                        <article class="manual-card">
                            <h3>License Management</h3>
                            <p>라이선스 수량, 가용 현황, 만료 상태를 통합해 컴플라이언스를 유지합니다.</p>
                        </article>
                        <article class="manual-card">
                            <h3>Master Data</h3>
                            <p>사업장/부서/사용자/카테고리/공급업체를 일관된 구조로 운영합니다.</p>
                        </article>
                        <article class="manual-card">
                            <h3>Search & Filter</h3>
                            <p>화면별 검색/필터/인덱스로 원하는 대상을 빠르게 찾고 범위를 좁힐 수 있습니다.</p>
                        </article>
                        <article class="manual-card">
                            <h3>Inventory & Alerts</h3>
                            <p>실사 일정과 알림 중심으로 누락 없이 운영 상황을 점검합니다.</p>
                        </article>
                        <article class="manual-card">
                            <h3>Import / Export</h3>
                            <p>템플릿 기반 대량 등록과 내보내기로 초기 구축과 운영 효율을 높입니다.</p>
                        </article>
                    </section>

                    <section class="manual-section">
                        <div class="manual-title">Tech Stack</div>
                        <div class="manual-chips">
                            <span class="manual-chip">Python</span>
                            <span class="manual-chip">Flask</span>
                            <span class="manual-chip">SQLite</span>
                            <span class="manual-chip">Vanilla JavaScript</span>
                            <span class="manual-chip">Chart.js</span>
                        </div>
                    </section>

                    <section class="manual-section">
                        <div class="manual-title">Security & Backup</div>
                        <p style="color:var(--gray-600);line-height:1.6;">
                            내부망 기반 운영을 기본으로 하며, 백업 정책에 따라 데이터를 주기적으로 보존합니다.
                            운영 환경에서는 AWS S3 자동 백업 정책을 통해 장애 시 복구 가능성을 높입니다.
                        </p>
                    </section>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="assetModal">
        <div class="modal">
            <div class="modal-header">
                <h3>자산 등록</h3><button class="modal-close" onclick="closeModal('assetModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="assetForm" class="compact-form">
                    <div class="form-group"><label class="form-label">자산명 *</label><input type="text" class="form-input"
                            name="asset_name" required></div>
                    <div class="form-group"><label class="form-label">카테고리 *</label><select class="form-select"
                            name="category_id" required id="assetCategorySelect"></select></div>
                    <div class="form-group"><label class="form-label">사업장 *</label><select class="form-select"
                            name="location_id" required id="assetLocationSelect"></select></div>
                    <div class="form-group"><label class="form-label">상태</label>
                        <select class="form-select" name="asset_status">
                            <option>신규</option>
                            <option>사용중</option>
                            <option>여유</option>
                        </select>
                    </div>
                    <div class="form-group"><label class="form-label">제조사</label><input type="text" class="form-input"
                            name="manufacturer"></div>
                    <div class="form-group"><label class="form-label">모델명</label><input type="text" class="form-input"
                            name="model_name"></div>
                    <div class="form-group"><label class="form-label">시리얼번호</label><input type="text" class="form-input"
                            name="serial_number"></div>
                    <div class="form-group"><label class="form-label">구매일</label><input type="date" class="form-input"
                            name="purchase_date"></div>
                    <div class="form-group"><label class="form-label">관리담당자 *</label><select class="form-select"
                            name="asset_manager_id" required id="assetManagerSelect"></select></div>
                    <input type="hidden" name="asset_id">
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('assetModal')">취소</button>
                <button class="btn btn-primary" onclick="saveAsset()">저장</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="licenseModal">
        <div class="modal">
            <div class="modal-header">
                <h3>라이선스 등록</h3><button class="modal-close" onclick="closeModal('licenseModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="licenseForm" class="compact-form">
                    <div class="form-group"><label class="form-label">소프트웨어명 *</label><input type="text"
                            class="form-input" name="software_name" required></div>
                    <div class="form-group"><label class="form-label">카테고리 *</label><select class="form-select"
                            name="category_id" required id="licenseCategorySelect"></select></div>
                    <div class="form-group"><label class="form-label">라이선스 유형 *</label>
                        <select class="form-select" name="license_type">
                            <option>구독</option>
                            <option>영구</option>
                            <option>볼륨</option>
                            <option>OEM</option>
                        </select>
                    </div>
                    <div class="form-group"><label class="form-label">측정단위 *</label>
                        <select class="form-select" name="license_metric">
                            <option value="per_user">사용자별</option>
                            <option value="per_device">기기별</option>
                            <option value="concurrent">동시접속</option>
                        </select>
                    </div>
                    <div class="form-group form-group-full"><label class="form-label">시리얼키 / 라이선스 키 (줄바꿈으로 일괄
                            등록)</label>
                        <textarea class="form-input" name="license_key" rows="2"
                            placeholder="XXXX-XXXX-XXXX-0001&#10;XXXX-XXXX-XXXX-0002"></textarea>
                    </div>
                    <div class="form-group"><label class="form-label">총수량 *</label><input type="number"
                            class="form-input" name="total_quantity" required></div>
                    <div class="form-group"><label class="form-label">관리담당자 *</label><select class="form-select"
                            name="license_manager_id" required id="licenseManagerSelect"></select></div>
                    <input type="hidden" name="license_id">
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('licenseModal')">취소</button>
                <button class="btn btn-primary" onclick="saveLicense()">저장</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="locationModal">
        <div class="modal">
            <div class="modal-header">
                <h3>사업장 등록</h3><button class="modal-close" onclick="closeModal('locationModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="locationForm">
                    <div class="form-group"><label class="form-label">사업장 코드 *</label><input type="text"
                            class="form-input" name="location_code" required></div>
                    <div class="form-group"><label class="form-label">사업장명 *</label><input type="text"
                            class="form-input" name="location_name" required></div>
                    <div class="form-group"><label class="form-label">주소</label><input type="text" class="form-input"
                            name="address"></div>
                    <div class="form-group"><label class="form-label">건물</label><input type="text" class="form-input"
                            name="building"></div>
                    <input type="hidden" name="location_id">
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('locationModal')">취소</button>
                <button class="btn btn-primary" onclick="saveLocation()">저장</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="userModal">
        <div class="modal">
            <div class="modal-header">
                <h3>사용자 등록</h3><button class="modal-close" onclick="closeModal('userModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="userForm">
                    <div class="form-group"><label class="form-label">사번 *</label><input type="text" class="form-input"
                            name="employee_no" required></div>
                    <div class="form-group"><label class="form-label">이름 *</label><input type="text" class="form-input"
                            name="user_name" required></div>
                    <div class="form-group"><label class="form-label">이메일 *</label><input type="email"
                            class="form-input" name="email" required></div>
                    <div class="form-group"><label class="form-label">부서 *</label><select class="form-select"
                            name="dept_id" required id="userDeptSelect"></select></div>
                    <div class="form-group"><label class="form-label">사업장 *</label><select class="form-select"
                            name="location_id" required id="userLocationSelect"></select></div>
                    <input type="hidden" name="user_id">
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('userModal')">취소</button>
                <button class="btn btn-primary" onclick="saveUser()">저장</button>
            </div>
        </div>
    </div>

    <!-- User Detail Modal -->
    <div class="modal-overlay" id="userDetailModal">
        <div class="modal" style="max-width:800px">
            <div class="modal-header">
                <h3 id="userDetailTitle">사용자 상세</h3>
                <button class="modal-close" onclick="closeModal('userDetailModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="userDetailContent" style="min-height:240px"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('userDetailModal')">닫기</button>
            </div>
        </div>
    </div>

    <!-- Department Modal -->
    <div class="modal-overlay" id="deptModal">
        <div class="modal">
            <div class="modal-header">
                <h3>부서 등록</h3><button class="modal-close" onclick="closeModal('deptModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="deptForm">
                    <div class="form-group"><label class="form-label">부서 코드 *</label><input type="text"
                            class="form-input" name="dept_code" required></div>
                    <div class="form-group"><label class="form-label">부서명 *</label><input type="text" class="form-input"
                            name="dept_name" required></div>
                    <div class="form-group"><label class="form-label">레벨 *</label>
                        <select class="form-select" name="dept_level">
                            <option value="1">1 (본부)</option>
                            <option value="2">2 (팀)</option>
                            <option value="3">3 (파트)</option>
                        </select>
                    </div>
                    <div class="form-group"><label class="form-label">사업장 *</label><select class="form-select"
                            name="location_id" required id="deptLocationSelect"></select></div>
                    <input type="hidden" name="dept_id">
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('deptModal')">취소</button>
                <button class="btn btn-primary" onclick="saveDept()">저장</button>
            </div>
        </div>
    </div>

    <!-- License Status Modal -->
    <div class="modal-overlay" id="licenseStatusModal">
        <div class="modal">
            <div class="modal-header">
                <h3>라이선스 상태 변경</h3><button class="modal-close"
                    onclick="closeModal('licenseStatusModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="licenseStatusForm">
                    <input type="hidden" name="license_id" id="statusLicenseId">
                    <div class="form-group">
                        <label class="form-label">현재 상태</label>
                        <input type="text" class="form-input" id="currentLicenseStatus" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">변경할 상태</label>
                        <select class="form-select" name="license_status">
                            <option>활성</option>
                            <option>만료예정</option>
                            <option>만료</option>
                            <option>해지</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('licenseStatusModal')">취소</button>
                <button class="btn btn-primary" onclick="executeLicenseStatusChange()">변경</button>
            </div>
        </div>
    </div>

    <!-- Vendor Modal -->
    <div class="modal-overlay" id="vendorModal">
        <div class="modal">
            <div class="modal-header">
                <h3>공급업체 등록</h3><button class="modal-close" onclick="closeModal('vendorModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="vendorForm">
                    <div class="form-group"><label class="form-label">업체명 *</label><input type="text" class="form-input"
                            name="vendor_name" required></div>
                    <div class="form-group"><label class="form-label">구분 *</label>
                        <select class="form-select" name="vendor_type">
                            <option>제조사</option>
                            <option>판매사</option>
                            <option>유지보수</option>
                            <option>종합</option>
                        </select>
                    </div>
                    <div class="form-group"><label class="form-label">담당자명</label><input type="text" class="form-input"
                            name="contact_name"></div>
                    <div class="form-group"><label class="form-label">연락처</label><input type="text" class="form-input"
                            name="contact_phone"></div>
                    <div class="form-group"><label class="form-label">이메일</label><input type="email" class="form-input"
                            name="contact_email"></div>
                    <input type="hidden" name="vendor_id">
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('vendorModal')">취소</button>
                <button class="btn btn-primary" onclick="saveVendor()">저장</button>
            </div>
        </div>
    </div>

    <!-- Inventory Modal -->
    <div class="modal-overlay" id="inventoryModal">
        <div class="modal">
            <div class="modal-header">
                <h3>실사 일정 등록</h3><button class="modal-close" onclick="closeModal('inventoryModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="inventoryForm">
                    <div class="form-group"><label class="form-label">실사명 *</label><input type="text" class="form-input"
                            name="schedule_name" required placeholder="2026년 상반기 자산실사"></div>
                    <div class="form-group"><label class="form-label">유형 *</label>
                        <select class="form-select" name="schedule_type">
                            <option>정기</option>
                            <option>수시</option>
                            <option>긴급</option>
                        </select>
                    </div>
                    <div class="form-group"><label class="form-label">주기</label>
                        <select class="form-select" name="frequency">
                            <option>반기</option>
                            <option>분기</option>
                            <option>연간</option>
                            <option>1회</option>
                        </select>
                    </div>
                    <div class="form-group"><label class="form-label">시작일 *</label><input type="date" class="form-input"
                            name="start_date" required></div>
                    <div class="form-group"><label class="form-label">마감일 *</label><input type="date" class="form-input"
                            name="end_date" required></div>
                    <div class="form-group"><label class="form-label">담당자 *</label><select class="form-select"
                            name="assigned_manager_id" required id="inventoryManagerSelect"></select></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('inventoryModal')">취소</button>
                <button class="btn btn-primary" onclick="saveInventory()">저장</button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal-overlay" id="importModal">
        <div class="modal">
            <div class="modal-header">
                <h3>데이터 Import</h3><button class="modal-close" onclick="closeModal('importModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom:16px;color:var(--gray-600)">엑셀 파일(.xlsx)을 선택하세요. 먼저 템플릿을 다운로드하여 양식에 맞게 작성해주세요.
                </p>
                <div class="form-group">
                    <label class="form-label">엑셀 파일</label>
                    <input type="file" id="importFile" accept=".xlsx,.xls" class="form-input">
                </div>
                <input type="hidden" id="importType">
                <div id="importResult" style="margin-top:16px"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('importModal')">취소</button>
                <button class="btn btn-primary" onclick="executeImport()">Import 실행</button>
            </div>
        </div>
    </div>

    <!-- Asset Detail Modal -->
    <div class="modal-overlay" id="assetDetailModal">
        <div class="modal" style="max-width:800px">
            <div class="modal-header">
                <h3 id="assetDetailTitle">자산 상세</h3>
                <button class="modal-close" onclick="closeModal('assetDetailModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tabs" id="assetDetailTabs" role="tablist" aria-label="자산 상세 탭">
                    <button type="button" class="tab active" role="tab" data-tab="info"
                        aria-selected="true">기본정보</button>
                    <button type="button" class="tab" role="tab" data-tab="assignments"
                        aria-selected="false">배정이력</button>
                    <button type="button" class="tab" role="tab" data-tab="history" aria-selected="false">변경이력</button>
                </div>
                <div id="assetDetailContent" style="min-height:300px"></div>
            </div>
            <div class="modal-footer" id="assetDetailFooter">
                <button class="btn btn-secondary" onclick="closeModal('assetDetailModal')">닫기</button>
            </div>
        </div>
    </div>

    <!-- Asset Assign Modal -->
    <div class="modal-overlay" id="assetAssignModal">
        <div class="modal">
            <div class="modal-header">
                <h3>자산 배정</h3>
                <button class="modal-close" onclick="closeModal('assetAssignModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom:16px;background:var(--gray-100);padding:12px;border-radius:8px"
                    id="assignAssetInfo"></p>
                <form id="assetAssignForm">
                    <div class="form-group">
                        <label class="form-label">배정할 사용자 *</label>
                        <select class="form-select" name="user_id" required id="assignUserSelect"></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">배정일</label>
                        <input type="date" class="form-input" name="assigned_date" value="">
                    </div>
                    <div class="form-group">
                        <label class="form-label">비고</label>
                        <input type="text" class="form-input" name="notes" placeholder="배정 사유">
                    </div>
                    <input type="hidden" name="asset_id" id="assignAssetId">
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('assetAssignModal')">취소</button>
                <button class="btn btn-primary" onclick="executeAssetAssign()">배정</button>
            </div>
        </div>
    </div>

    <!-- Asset Status Change Modal -->
    <div class="modal-overlay" id="assetStatusModal">
        <div class="modal">
            <div class="modal-header">
                <h3>상태 변경</h3>
                <button class="modal-close" onclick="closeModal('assetStatusModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom:16px;background:var(--gray-100);padding:12px;border-radius:8px"
                    id="statusAssetInfo"></p>
                <form id="assetStatusForm">
                    <div class="form-group">
                        <label class="form-label">현재 상태</label>
                        <input type="text" class="form-input" id="currentStatus" readonly
                            style="background:var(--gray-50)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">변경할 상태 *</label>
                        <select class="form-select" name="new_status" required id="newStatusSelect">
                            <option value="사용중">사용중</option>
                            <option value="여유">여유</option>
                            <option value="수리중">수리중</option>
                            <option value="폐기예정">폐기예정</option>
                            <option value="분실">분실</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">변경 사유 *</label>
                        <input type="text" class="form-input" name="reason" required placeholder="상태 변경 사유 입력">
                    </div>
                    <input type="hidden" name="asset_id" id="statusAssetId">
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('assetStatusModal')">취소</button>
                <button class="btn btn-primary" onclick="executeStatusChange()">변경</button>
            </div>
        </div>
    </div>

    <!-- Asset Dispose Modal -->
    <div class="modal-overlay" id="assetDisposeModal">
        <div class="modal">
            <div class="modal-header">
                <h3>자산 폐기 처리</h3>
                <button class="modal-close" onclick="closeModal('assetDisposeModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom:16px;background:var(--danger-light);padding:12px;border-radius:8px;color:var(--danger)"
                    id="disposeAssetInfo"><i data-lucide="alert-triangle"
                        style="width:16px;height:16px;display:inline-block;vertical-align:middle;margin-right:4px"></i>
                    폐기 처리 시 되돌릴 수 없습니다.</p>
                <form id="assetDisposeForm">
                    <div class="form-group">
                        <label class="form-label">폐기 사유 *</label>
                        <textarea class="form-input" name="disposal_reason" required rows="2"
                            placeholder="예: 내용연수 초과, 고장 수리 불가 등"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">폐기일 *</label>
                            <input type="date" class="form-input" name="disposal_date" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">처리 방법</label>
                            <select class="form-select" name="disposal_method">
                                <option value="폐기업체 위탁">폐기업체 위탁</option>
                                <option value="매각">매각</option>
                                <option value="기증">기증</option>
                                <option value="자체 폐기">자체 폐기</option>
                                <option value="기타">기타</option>
                            </select>
                        </div>
                    </div>
                    <input type="hidden" name="asset_id" id="disposeAssetId">
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('assetDisposeModal')">취소</button>
                <button class="btn btn-danger" onclick="executeDispose()">폐기 처리</button>
            </div>
        </div>
    </div>

    <!-- License Detail Modal -->
    <div class="modal-overlay" id="licenseDetailModal">
        <div class="modal" style="max-width:800px">
            <div class="modal-header">
                <h3 id="licenseDetailTitle">라이선스 상세</h3>
                <button class="modal-close" onclick="closeModal('licenseDetailModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="licenseDetailInfo" style="margin-bottom:20px"></div>
                <div class="tabs" id="licenseDetailTabs" role="tablist" aria-label="라이선스 상세 탭">
                    <button type="button" class="tab active" role="tab" data-tab="assignments" aria-selected="true">할당
                        목록</button>
                    <button type="button" class="tab" role="tab" data-tab="keys" aria-selected="false">키 목록</button>
                </div>
                <div id="licenseAssignmentsPanel">
                    <div class="chart-title">할당자 목록</div>
                    <div class="table-container" style="box-shadow:none;border:1px solid var(--gray-200)">
                        <table>
                            <thead>
                                <tr>
                                    <th>사용자</th>
                                    <th>부서</th>
                                    <th>할당일</th>
                                    <th>시리얼키</th>
                                    <th>관리</th>
                                </tr>
                            </thead>
                            <tbody id="licenseAssignmentsTable"></tbody>
                        </table>
                    </div>
                </div>
                <div id="licenseKeysPanel" style="display:none">
                    <div
                        style="display:flex;gap:8px;align-items:center;justify-content:space-between;margin:8px 0 10px">
                        <input type="text" class="form-input" id="licenseKeySearch" placeholder="키/상태/사용자 검색"
                            oninput="renderLicenseKeysTable()" style="max-width:280px">
                        <div style="display:flex;gap:8px;align-items:center">
                            <span id="licenseKeyCount" style="font-size:0.875rem;color:var(--gray-600)"></span>
                            <button class="btn btn-secondary btn-sm" onclick="copyLicenseKeys()">키 복사</button>
                            <button class="btn btn-secondary btn-sm" onclick="exportLicenseKeysCsv()">CSV</button>
                        </div>
                    </div>
                    <div class="table-container" style="box-shadow:none;border:1px solid var(--gray-200)">
                        <table>
                            <thead>
                                <tr>
                                    <th>시리얼키</th>
                                    <th>상태</th>
                                    <th>할당 대상</th>
                                    <th>할당일</th>
                                    <th>회수일</th>
                                </tr>
                            </thead>
                            <tbody id="licenseKeysTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('licenseDetailModal')">닫기</button>
                <button class="btn btn-primary" onclick="openLicenseAssignModal()">+ 할당</button>
            </div>
        </div>
    </div>

    <!-- License Assign Modal -->
    <div class="modal-overlay" id="licenseAssignModal">
        <div class="modal">
            <div class="modal-header">
                <h3>라이선스 할당</h3>
                <button class="modal-close" onclick="closeModal('licenseAssignModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom:16px;background:var(--gray-100);padding:12px;border-radius:8px"
                    id="assignLicenseInfo"></p>
                <form id="licenseAssignForm">
                    <div class="form-group" id="licenseUserGroup">
                        <label class="form-label">할당할 사용자 *</label>
                        <select class="form-select" name="user_id" id="licenseAssignUserSelect"></select>
                    </div>
                    <div class="form-group" id="licenseAssetGroup" style="display:none">
                        <label class="form-label">할당할 자산 *</label>
                        <select class="form-select" name="asset_id" id="licenseAssignAssetSelect"></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">비고</label>
                        <input type="text" class="form-input" name="notes" placeholder="할당 메모">
                    </div>
                    <input type="hidden" name="license_id" id="assignLicenseId">
                    <input type="hidden" name="license_metric" id="assignLicenseMetric">
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('licenseAssignModal')">취소</button>
                <button class="btn btn-primary" onclick="executeLicenseAssign()">할당</button>
            </div>
        </div>
    </div>

    <!-- EOS Modal -->
    <div class="modal-overlay" id="eosModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="eosModalTitle">EOS 정보 등록</h3>
                <button class="modal-close" onclick="closeModal('eosModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="eosForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">제품명 *</label>
                            <input type="text" class="form-input" name="product_name" required
                                placeholder="예: Windows 10">
                        </div>
                        <div class="form-group">
                            <label class="form-label">버전</label>
                            <input type="text" class="form-input" name="product_version" placeholder="예: 21H2">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">유형 *</label>
                            <select class="form-select" name="eos_type" required>
                                <option value="OS">운영체제(OS)</option>
                                <option value="SW">소프트웨어</option>
                                <option value="HW">하드웨어</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">제조사</label>
                            <input type="text" class="form-input" name="manufacturer" placeholder="예: Microsoft">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">EOS 일자 *</label>
                        <input type="date" class="form-input" name="eos_date" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">비고</label>
                        <textarea class="form-input" name="notes" rows="2" placeholder="EOS 관련 참고 사항"></textarea>
                    </div>
                    <input type="hidden" name="eos_id" id="eosId">
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('eosModal')">취소</button>
                <button class="btn btn-primary" onclick="saveEOS()">저장</button>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div class="modal-overlay" id="categoryModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="categoryModalTitle">카테고리 등록</h3>
                <button class="modal-close" onclick="closeModal('categoryModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="categoryForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">카테고리 코드 *</label>
                            <input type="text" class="form-input" name="category_code" required
                                placeholder="예: HW-NET-SW">
                        </div>
                        <div class="form-group">
                            <label class="form-label">카테고리명 *</label>
                            <input type="text" class="form-input" name="category_name" required placeholder="예: 스위치">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">레벨 *</label>
                            <select class="form-select" name="category_level" required
                                onchange="updateParentCategoryOptions(this.value)">
                                <option value="1">1 (대분류)</option>
                                <option value="2">2 (중분류)</option>
                                <option value="3" selected>3 (소분류)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">자산유형 *</label>
                            <select class="form-select" name="asset_type" required>
                                <option value="HW">HW (하드웨어)</option>
                                <option value="SW">SW (소프트웨어)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" id="parentCategoryGroup">
                        <label class="form-label">상위 카테고리</label>
                        <select class="form-select" name="parent_category_id" id="parentCategorySelect">
                            <option value="">없음</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">사용연한 (월)</label>
                        <input type="number" class="form-input" name="useful_life_months" placeholder="예: 60">
                    </div>
                    <input type="hidden" name="category_id" id="categoryId">
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('categoryModal')">취소</button>
                <button class="btn btn-primary" onclick="saveCategory()">저장</button>
            </div>
        </div>
    </div>

    <script>
        // Auto-initialize Lucide icons on DOM changes (debounced, no infinite loop)
        let _lucideTimer = null;
        let _lucideRunning = false;
        const _lucideObserver = new MutationObserver(() => {
            if (_lucideRunning || !window.lucide) return;
            clearTimeout(_lucideTimer);
            _lucideTimer = setTimeout(() => {
                _lucideRunning = true;
                lucide.createIcons();
                _lucideRunning = false;
            }, 50);
        });
        _lucideObserver.observe(document.body, { childList: true, subtree: true });
        document.addEventListener('DOMContentLoaded', () => {
            if (window.lucide) lucide.createIcons();
        });

        // API Layer
        // - 모든 백엔드 API 호출을 하나의 helper로 통합
        // - JSON 응답만 처리하고 비-JSON 응답은 실패 객체로 정규화
        const api = {
            request: async (url, options = {}) => {
                const res = await fetch(url, options);
                const contentType = res.headers.get('content-type') || '';
                if (!contentType.includes('application/json')) {
                    const text = await res.text();
                    return {
                        success: false,
                        message: `HTTP ${res.status} ${res.statusText}`,
                        error: text
                    };
                }
                return res.json();
            },
            get: async (url) => api.request(url),
            post: async (url, data) => api.request(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) }),
            put: async (url, data) => api.request(url, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) }),
            delete: async (url) => api.request(url, { method: 'DELETE' })
        };

        // Global Data Cache
        // - 기준정보는 자주 쓰는 select와 목록 렌더링에서 재사용
        // - EOS는 페이지/필터에서 함께 사용되는 전역 참조 데이터
        let locations = [], departments = [], users = [], categories = [], vendors = [], eosInfos = [];
        const dashboardCharts = {
            category: null,
            location: null,
            department: null
        };

        function renderDashboardChart(key, canvasId, config) {
            if (dashboardCharts[key]) {
                dashboardCharts[key].destroy();
            }
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            dashboardCharts[key] = new Chart(canvas, config);
        }

        // Navigation
        // - data-page 기반 라우팅 + 페이지 표시 토글
        // - 페이지 전환 시 해당 페이지 데이터 로더 1개만 호출
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.nav-item').forEach(i => {
                    i.classList.remove('active');
                    i.removeAttribute('aria-current');
                });
                item.classList.add('active');
                item.setAttribute('aria-current', 'page');
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById('page-' + item.dataset.page).classList.add('active');
                loadPageData(item.dataset.page);
            });
        });

        function loadPageData(page) {
            // 각 페이지별 로더를 한 곳에서 분기해 유지보수 포인트를 제한
            const loaders = {
                dashboard: loadDashboard, assets: loadAssets, licenses: loadLicenses,
                locations: loadLocations, departments: loadDepartments, users: loadUsers,
                categories: loadCategories, vendors: loadVendors, eos: loadEOS,
                inventories: loadInventories, notifications: loadNotifications,
                manual: loadManual
            };
            if (page === 'licenses') renderLicenseVendorFilter();
            if (loaders[page]) loaders[page]();
        }

        // 설명서 페이지는 템플릿 정적 노출이므로 별도 API 호출 없이도 안정적으로 빠르게 표시
        function loadManual() { }

        // Modal Helpers
        // - 공통 모달 열기/닫기 로직 + 이벤트/폼 데이터 파서 유틸을 분리
        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        function getEventAndId(arg1, arg2) {
            if (arg1 && typeof arg1 === 'object' && typeof arg1.preventDefault === 'function') {
                return { evt: arg1, id: arg2 };
            }
            return { evt: null, id: arg1 };
        }
        function stopActionEvent(evt) {
            if (!evt) return;
            evt.preventDefault();
            evt.stopPropagation();
        }
        function getFormData(formId) {
            const form = document.getElementById(formId);
            const data = {};
            new FormData(form).forEach((v, k) => { if (v) data[k] = v; });
            return data;
        }

        // Debounced 검색 헬퍼
        // - oninput/keyup 입력이 잦을 때 API 호출을 최소화
        const searchDebounceTimers = {};
        function runDebouncedLoad(key, loader, delay = 250) {
            clearTimeout(searchDebounceTimers[key]);
            searchDebounceTimers[key] = setTimeout(() => loader(), delay);
        }
        function debouncedLoadLocations() { runDebouncedLoad('locations', loadLocations); }
        function debouncedLoadDepartments() { runDebouncedLoad('departments', loadDepartments); }
        function debouncedLoadUsers() { runDebouncedLoad('users', loadUsers); }
        function debouncedLoadCategories() { runDebouncedLoad('categories', loadCategories); }
        function debouncedLoadVendors() { runDebouncedLoad('vendors', loadVendors); }
        function debouncedLoadEOS() { runDebouncedLoad('eos', loadEOS); }

        // 숫자 포맷팅 유틸리티 (KO locale)
        function formatNumber(num) {
            if (num === null || num === undefined) return '0';
            return new Intl.NumberFormat('ko-KR').format(num);
        }

        // Dashboard
        // - 카드(요약 지표), 카테고리/위치/부서 차트, 최근활동을 한 번에 로딩
        async function loadDashboard() {
            const summary = await api.get('/api/dashboard/summary');
            if (summary.success) {
                const d = summary.data;
                document.getElementById('summary-cards').innerHTML = `
                    <div class="card" role="article" aria-labelledby="card-total">
                        <div class="card-title" id="card-total">
                            <i data-lucide="package" style="width:15px;height:15px"></i> 총 자산
                        </div>
                        <div class="card-value" aria-label="${d.total}개">${formatNumber(d.total)}</div>
                    </div>
                    <div class="card" role="article" aria-labelledby="card-in-use">
                        <div class="card-title" id="card-in-use">
                            <i data-lucide="check-circle-2" style="width:15px;height:15px;color:var(--success)"></i> 사용중
                        </div>
                        <div class="card-value success" aria-label="${d.in_use}개">${formatNumber(d.in_use)}</div>
                    </div>
                    <div class="card" role="article" aria-labelledby="card-available">
                        <div class="card-title" id="card-available">
                            <i data-lucide="pause-circle" style="width:15px;height:15px;color:var(--gray-500)"></i> 여유
                        </div>
                        <div class="card-value" aria-label="${d.available}개">${formatNumber(d.available)}</div>
                    </div>
                    <div class="card" role="article" aria-labelledby="card-repair">
                        <div class="card-title" id="card-repair">
                            <i data-lucide="wrench" style="width:15px;height:15px;color:var(--warning)"></i> 수리중
                        </div>
                        <div class="card-value warning" aria-label="${d.repair}개">${formatNumber(d.repair)}</div>
                    </div>
                    <div class="card" role="article" aria-labelledby="card-disposal">
                        <div class="card-title" id="card-disposal">
                            <i data-lucide="alert-triangle" style="width:15px;height:15px;color:var(--danger)"></i> 폐기예정
                        </div>
                        <div class="card-value danger" aria-label="${d.pending_disposal}개">${formatNumber(d.pending_disposal)}</div>
                    </div>
                    <div class="card" role="article" aria-labelledby="card-disposed">
                        <div class="card-title" id="card-disposed">
                            <i data-lucide="trash-2" style="width:15px;height:15px;color:var(--gray-400)"></i> 폐기완료
                        </div>
                        <div class="card-value" style="color:var(--gray-500)" aria-label="${d.disposed || 0}개">${formatNumber(d.disposed || 0)}</div>
                    </div>
                    <div class="card" role="article" aria-labelledby="card-lic-expiring">
                        <div class="card-title" id="card-lic-expiring">
                            <i data-lucide="clock" style="width:15px;height:15px;color:var(--warning)"></i> 라이선스 만료 임박
                        </div>
                        <div class="card-value warning" aria-label="${d.license_expiring || 0}건">${formatNumber(d.license_expiring || 0)}</div>
                    </div>
                    <div class="card" role="article" aria-labelledby="card-lic-expired">
                        <div class="card-title" id="card-lic-expired">
                            <i data-lucide="x-circle" style="width:15px;height:15px;color:var(--danger)"></i> 라이선스 만료
                        </div>
                        <div class="card-value danger" aria-label="${d.license_expired || 0}건">${formatNumber(d.license_expired || 0)}</div>
                    </div>
                `;
            }

            const catData = await api.get('/api/dashboard/by-category');
            if (catData.success && catData.data.length) {
                renderDashboardChart('category', 'categoryChart', {
                    type: 'bar', data: {
                        labels: catData.data.map(c => c.category_name),
                        datasets: [{
                            label: '자산 수', data: catData.data.map(c => c.count),
                            backgroundColor: ['#334155', '#475569', '#64748B', '#94A3B8', '#CBD5E1', '#E2E8F0']
                        }]
                    }, options: { responsive: true, plugins: { legend: { display: false } } }
                });
            }

            const licStatus = await api.get('/api/dashboard/license-status');
            if (licStatus.success) {
                document.getElementById('licenseStatus').innerHTML = licStatus.data.map(l => {
                    const pct = l.total_quantity ? (l.used_quantity / l.total_quantity * 100) : 0;
                    const color = l.compliance_status === '초과' ? 'var(--danger)' : pct > 80 ? 'var(--warning)' : 'var(--success)';
                    return `<div class="license-item">
                        <span>${l.software_name}</span>
                        <div style="display:flex;align-items:center;gap:10px">
                            <div class="license-bar"><div class="license-bar-fill" style="width:${Math.min(pct, 100)}%;background:${color}"></div></div>
                            <span style="color:${color}">${l.used_quantity}/${l.total_quantity}</span>
                        </div>
                    </div>`;
                }).join('');
            }

            const ulExp = await api.get('/api/dashboard/useful-life-expired');
            document.getElementById('usefulLifeExpired').innerHTML = ulExp.success && ulExp.data.length ?
                ulExp.data.map(u => `<div class="activity-item"><i data-lucide="alert-triangle" style="width:14px;height:14px;display:inline-block;vertical-align:middle;color:var(--warning);margin-right:4px"></i> ${u.category_name}: ${u.count}대</div>`).join('') : '<p style="color:var(--gray-600)">초과 자산 없음</p>';

            const eosExp = await api.get('/api/dashboard/eos-status');
            document.getElementById('eosStatus').innerHTML = eosExp.success && eosExp.data.length ?
                eosExp.data.map(e => `<div class="activity-item"><i data-lucide="circle-alert" style="width:14px;height:14px;display:inline-block;vertical-align:middle;color:var(--danger);margin-right:4px"></i> ${e.product_name}: ${e.count}대</div>`).join('') : '<p style="color:var(--gray-600)">EOS 자산 없음</p>';

            // 사업장별
            const locData = await api.get('/api/dashboard/by-location');
            if (locData.success && locData.data.length) {
                renderDashboardChart('location', 'locationChart', {
                    type: 'doughnut', data: {
                        labels: locData.data.map(l => l.location_name),
                        datasets: [{
                            data: locData.data.map(l => l.count),
                            backgroundColor: ['#4F46E5', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#EC4899', '#06B6D4']
                        }]
                    }, options: { responsive: true, plugins: { legend: { position: 'right' } } }
                });
            }

            // 부서별
            const deptData = await api.get('/api/dashboard/by-department');
            if (deptData.success && deptData.data.length) {
                renderDashboardChart('department', 'departmentChart', {
                    type: 'bar', data: {
                        labels: deptData.data.map(d => d.dept_name),
                        datasets: [{
                            label: '보유 자산', data: deptData.data.map(d => d.count),
                            backgroundColor: '#10B981'
                        }]
                    }, options: { indexAxis: 'y', responsive: true, plugins: { legend: { display: false } } }
                });
            }

            const activity = await api.get('/api/dashboard/recent-activity');
            document.getElementById('recentActivity').innerHTML = activity.success ?
                activity.data.slice(0, 10).map(a => `<div class="activity-item"><div class="activity-time">${a.action_date}</div><div class="activity-text">${a.action_detail || a.action_type}</div></div>`).join('') : '';
        }

        // Assets (HW 자산)
        // - 검색/필터 조건으로 API 조회 후 응답 순번을 표시 인덱스로 사용
        async function loadAssets() {
            const keyword = document.getElementById('assetSearch')?.value || '';
            const loc = document.getElementById('assetLocationFilter')?.value || '';
            const status = document.getElementById('assetStatusFilter')?.value || '';
            let url = '/api/assets?';
            if (keyword) url += `keyword=${keyword}&`;
            if (loc) url += `location_id=${loc}&`;
            if (status) url += `status=${status}&`;
            const res = await api.get(url);
            if (res.success) {
                document.getElementById('assetsTable').innerHTML = res.data.map((a, idx) => `<tr>
                    <td class="index-col">${idx + 1}</td>
                    <td>${a.asset_number}</td><td>${a.asset_name}</td><td>${a.category_name || ''}</td>
                    <td><span class="badge ${a.asset_status === '사용중' ? 'badge-success' : a.asset_status === '여유' ? 'badge-info' : 'badge-warning'}">${a.asset_status}</span></td>
                    <td>${a.location_name || ''}</td><td>${a.current_user_name || '-'}</td>
                <td><span class="action-group"><button class="btn btn-sm btn-action btn-action-primary" onclick="openAssetDetail(${a.asset_id})"><span class="btn-icon"><i data-lucide="search" style="width:13px;height:13px"></i></span>상세</button> <button class="btn btn-sm btn-action btn-action-secondary" onclick="editAsset(${a.asset_id})"><span class="btn-icon"><i data-lucide="pencil" style="width:13px;height:13px"></i></span>수정</button></span></td>
                </tr>`).join('');
            }
        }
        async function openAssetModal(data = {}) {
            await loadMasterData();
            document.getElementById('assetCategorySelect').innerHTML = categories.filter(c => c.category_level === 3).map(c => `<option value="${c.category_id}">${c.category_name}</option>`).join('');
            document.getElementById('assetLocationSelect').innerHTML = locations.map(l => `<option value="${l.location_id}">${l.location_name}</option>`).join('');
            document.getElementById('assetManagerSelect').innerHTML = users.filter(u => u.is_active).map(u => `<option value="${u.user_id}">${u.user_name}</option>`).join('');
            document.getElementById('assetForm').reset();
            openModal('assetModal');
        }
        async function saveAsset() {
            const data = getFormData('assetForm');
            const res = data.asset_id ? await api.put(`/api/assets/${data.asset_id}`, data) : await api.post('/api/assets', data);
            if (res.success) { closeModal('assetModal'); loadAssets(); alert(res.message); }
            else alert(res.message);
        }
        async function editAsset(id) {
            const res = await api.get(`/api/assets/${id}`);
            if (res.success) {
                await openAssetModal();
                const form = document.getElementById('assetForm');
                Object.keys(res.data).forEach(k => { if (form[k]) form[k].value = res.data[k]; });
            }
        }

        // Licenses (SW 라이선스)
        // - 검색/공급사/사용여부/상태 조건으로 화면 단에서 2차 필터링
        function getLicenseStatusBadgeClass(status) {
            if (status === '만료' || status === '해지') return 'badge-danger';
            if (status === '만료예정') return 'badge-warning';
            return 'badge-success';
        }
        async function loadLicenses() {
            const res = await api.get('/api/licenses');
            if (res.success) {
                const keyword = (document.getElementById('licenseSearch')?.value || '').trim().toLowerCase();
                const vendorId = document.getElementById('licenseVendorFilter')?.value || '';
                const usedFilter = document.getElementById('licenseUsedFilter')?.value || '';
                const statusFilter = document.getElementById('licenseListFilter')?.value || '';
                const filtered = res.data.filter(l => {
                    const keywordMatch = !keyword
                        || (l.license_number || '').toLowerCase().includes(keyword)
                        || (l.software_name || '').toLowerCase().includes(keyword)
                        || (l.vendor_name || '').toLowerCase().includes(keyword);
                    const vendorMatch = !vendorId || String(l.vendor_id || '') === String(vendorId);
                    const used = Number(l.used_quantity || 0);
                    const usedMatch = usedFilter === 'used' ? used > 0
                        : usedFilter === 'unused' ? used === 0
                            : true;
                    const status = l.license_status || '활성';
                    const statusMatch = !statusFilter || status === statusFilter;
                    return keywordMatch && vendorMatch && usedMatch && statusMatch;
                });
                document.getElementById('licensesTable').innerHTML = filtered.map((l, idx) => `<tr>
                    <td class="index-col">${idx + 1}</td>
                    <td>${l.license_number}</td>
                    <td><button type="button" class="table-link-btn" onclick="openLicenseDetail(${l.license_id})">${l.software_name}</button></td>
                    <td>${l.license_type}</td>
                    <td>${l.total_quantity}</td>
                    <td>${l.used_quantity}</td>
                    <td>${l.available_quantity}</td>
                    <td>
                        <span class="badge ${l.compliance_status === '정상' ? 'badge-success' : 'badge-danger'}">${l.compliance_status}</span>
                        <span class="badge ${getLicenseStatusBadgeClass(l.license_status || '활성')}">${l.license_status || '활성'}</span>
                    </td>
                    <td>
                        <span class="action-group">
                            <button class="btn btn-sm btn-action btn-action-secondary" onclick="editLicense(${l.license_id})"><span class="btn-icon"><i data-lucide="pencil" style="width:13px;height:13px"></i></span>수정</button>
                            <button class="btn btn-sm btn-action btn-action-danger" onclick="deleteLicense(${l.license_id})"><span class="btn-icon"><i data-lucide="trash-2" style="width:13px;height:13px"></i></span>삭제</button>
                        </span>
                    </td>
                </tr>`).join('');
            }
        }
        function openLicenseStatusModal() {
            document.getElementById('statusLicenseId').value = currentLicenseId;
            const currentStatus = document.getElementById('currentLicenseStatusBadge').textContent;
            document.getElementById('currentLicenseStatus').value = currentStatus;
            openModal('licenseStatusModal');
        }
        async function executeLicenseStatusChange() {
            const id = document.getElementById('statusLicenseId').value;
            const status = document.getElementById('licenseStatusForm').license_status.value;
            const res = await api.post(`/api/licenses/${id}/change-status`, { license_status: status });
            if (res.success) {
                closeModal('licenseStatusModal');
                closeModal('licenseDetailModal');
                loadLicenses();
                loadDashboard();
                alert(res.message);
            } else alert(res.message);
        }
        async function openLicenseModal() {
            await loadMasterData();
            document.querySelector('#licenseModal .modal-header h3').textContent = '라이선스 등록';
            document.getElementById('licenseCategorySelect').innerHTML = categories.filter(c => c.asset_type === 'SW').map(c => `<option value="${c.category_id}">${c.category_name}</option>`).join('');
            document.getElementById('licenseManagerSelect').innerHTML = users.filter(u => u.is_active).map(u => `<option value="${u.user_id}">${u.user_name}</option>`).join('');
            document.getElementById('licenseForm').reset();
            document.getElementById('licenseForm').license_id.value = '';
            openModal('licenseModal');
        }
        async function saveLicense() {
            const form = document.getElementById('licenseForm');
            const data = {
                software_name: form.software_name.value,
                category_id: parseInt(form.category_id.value),
                license_type: form.license_type.value,
                license_metric: form.license_metric.value,
                license_key: form.license_key.value || '',
                total_quantity: parseInt(form.total_quantity.value || '0'),
                license_manager_id: parseInt(form.license_manager_id.value)
            };
            if (data.total_quantity <= 0 && !data.license_key.trim()) {
                alert('총수량 또는 시리얼키를 입력해주세요.');
                return;
            }
            if (!data.software_name || !data.category_id || !data.license_type || !data.license_metric || !data.license_manager_id) {
                alert('필수 항목을 모두 입력해주세요.');
                return;
            }
            const id = form.license_id.value;
            const finalRes = id ? await api.put(`/api/licenses/${id}`, data) : await api.post('/api/licenses', data);
            if (finalRes.success) { closeModal('licenseModal'); loadLicenses(); alert(finalRes.message); }
            else alert(finalRes.message);
        }
        // Asset Detail Functions
        // - 상세 탭 및 상태/배정/이력 조회를 분기해서 렌더링
        let currentAssetId = null;
        async function openAssetDetail(id) {
            currentAssetId = id;
            const res = await api.get(`/api/assets/${id}`);
            if (!res.success) return alert(res.message);
            const a = res.data;
            document.getElementById('assetDetailTitle').textContent = `자산 상세: ${a.asset_number}`;
            // Setup tabs
            document.querySelectorAll('#assetDetailTabs .tab').forEach(tab => {
                tab.onclick = () => switchAssetTab(tab.dataset.tab, a);
            });
            switchAssetTab('info', a);
            // Footer buttons based on status
            let footer = '<button class="btn btn-secondary" onclick="closeModal(\'assetDetailModal\')">닫기</button> ';
            if (a.asset_status === '여유' || a.asset_status === '신규') {
                footer += '<button class="btn btn-primary" onclick="openAssetAssignModal()">배정</button> ';
            }
            if (a.asset_status === '사용중' && a.current_user_id) {
                footer += '<button class="btn btn-warning" onclick="executeAssetReturn()">회수</button> ';
            }
            if (a.asset_status === '폐기예정') {
                footer += '<button class="btn btn-danger" onclick="openAssetDisposeModal()">폐기 처리</button> ';
            }
            if (a.asset_status !== '폐기완료') {
                footer += '<button class="btn btn-secondary" onclick="openAssetStatusModal()">상태변경</button>';
            }
            document.getElementById('assetDetailFooter').innerHTML = footer;
            openModal('assetDetailModal');
        }
        function switchAssetTab(tab, asset) {
            document.querySelectorAll('#assetDetailTabs .tab').forEach(t => {
                const isActive = t.dataset.tab === tab;
                t.classList.toggle('active', isActive);
                t.setAttribute('aria-selected', isActive ? 'true' : 'false');
            });
            const content = document.getElementById('assetDetailContent');
            if (tab === 'info') {
                content.innerHTML = `<div class="info-grid">
                        <div class="info-item"><div class="info-label">자산번호</div><div class="info-value">${asset.asset_number}</div></div>
                        <div class="info-item"><div class="info-label">자산명</div><div class="info-value">${asset.asset_name}</div></div>
                        <div class="info-item"><div class="info-label">상태</div><div class="info-value"><span class="badge ${asset.asset_status === '사용중' ? 'badge-success' : 'badge-info'}">${asset.asset_status}</span></div></div>
                        <div class="info-item"><div class="info-label">사업장</div><div class="info-value">${asset.location_name || '-'}</div></div>
                        <div class="info-item"><div class="info-label">카테고리</div><div class="info-value">${asset.category_name || '-'}</div></div>
                        <div class="info-item"><div class="info-label">제조사</div><div class="info-value">${asset.manufacturer || '-'}</div></div>
                        <div class="info-item"><div class="info-label">모델명</div><div class="info-value">${asset.model_name || '-'}</div></div>
                        <div class="info-item"><div class="info-label">시리얼번호</div><div class="info-value">${asset.serial_number || '-'}</div></div>
                        <div class="info-item"><div class="info-label">구매일</div><div class="info-value">${asset.purchase_date || '-'}</div></div>
                        <div class="info-item"><div class="info-label">현재 사용자</div><div class="info-value">${asset.current_user_name || '-'}</div></div>
                    </div>`;
            } else if (tab === 'assignments') {
                loadAssetAssignments(asset.asset_id);
            } else if (tab === 'history') {
                loadAssetHistory(asset.asset_id);
            }
        }
        async function loadAssetAssignments(id) {
            const res = await api.get(`/api/assets/${id}/assignments`);
            const content = document.getElementById('assetDetailContent');
            if (res.success && res.data.length) {
                content.innerHTML = '<table style="width:100%"><thead><tr><th>사용자</th><th>부서</th><th>배정일</th><th>반납일</th></tr></thead><tbody>' +
                    res.data.map(a => `<tr><td>${a.user_name}</td><td>${a.dept_name || '-'}</td><td>${a.assigned_date || '-'}</td><td>${a.returned_date || '사용중'}</td></tr>`).join('') + '</tbody></table>';
            } else {
                content.innerHTML = '<p style="color:var(--gray-600);padding:20px">배정 이력이 없습니다.</p>';
            }
        }
        async function loadAssetHistory(id) {
            const res = await api.get(`/api/assets/${id}/history`);
            const content = document.getElementById('assetDetailContent');
            if (res.success && res.data.length) {
                content.innerHTML = '<div class="timeline">' +
                    res.data.slice(0, 20).map(h => `<div class="timeline-item">
                            <div class="timeline-date">${h.action_date}</div>
                            <div class="timeline-action">${h.action_type}</div>
                            <div class="timeline-detail">${h.action_detail || ''}</div>
                        </div>`).join('') + '</div>';
            } else {
                content.innerHTML = '<p style="color:var(--gray-600);padding:20px">변경 이력이 없습니다.</p>';
            }
        }
        async function openAssetAssignModal() {
            await loadMasterData();
            const res = await api.get(`/api/assets/${currentAssetId}`);
            document.getElementById('assignAssetInfo').innerHTML = `<strong>${res.data.asset_number}</strong> ${res.data.asset_name}`;
            document.getElementById('assignUserSelect').innerHTML = users.filter(u => u.is_active).map(u => `<option value="${u.user_id}">${u.user_name} (${u.dept_name || ''})</option>`).join('');
            document.getElementById('assignAssetId').value = currentAssetId;
            document.getElementById('assetAssignForm').reset();
            document.querySelector('[name="assigned_date"]').value = new Date().toISOString().split('T')[0];
            openModal('assetAssignModal');
        }
        async function executeAssetAssign() {
            const data = getFormData('assetAssignForm');
            const res = await api.post(`/api/assets/${data.asset_id}/assign`, data);
            if (res.success) {
                closeModal('assetAssignModal');
                closeModal('assetDetailModal');
                loadAssets();
                alert(res.message);
            } else alert(res.message);
        }
        async function executeAssetReturn() {
            if (!confirm('이 자산을 회수하시겠습니까?')) return;
            const res = await api.post(`/api/assets/${currentAssetId}/return`, {});
            if (res.success) {
                closeModal('assetDetailModal');
                loadAssets();
                alert(res.message);
            } else alert(res.message);
        }
        async function openAssetStatusModal() {
            const res = await api.get(`/api/assets/${currentAssetId}`);
            document.getElementById('statusAssetInfo').innerHTML = `<strong>${res.data.asset_number}</strong> ${res.data.asset_name}`;
            document.getElementById('currentStatus').value = res.data.asset_status;
            document.getElementById('statusAssetId').value = currentAssetId;
            document.getElementById('assetStatusForm').reset();
            document.getElementById('currentStatus').value = res.data.asset_status;
            openModal('assetStatusModal');
        }
        async function executeStatusChange() {
            const data = getFormData('assetStatusForm');
            const res = await api.post(`/api/assets/${data.asset_id}/change-status`, data);
            if (res.success) {
                closeModal('assetStatusModal');
                closeModal('assetDetailModal');
                loadAssets();
                alert(res.message);
            } else alert(res.message);
        }
        function openAssetDisposeModal() {
            document.getElementById('assetDisposeForm').reset();
            document.getElementById('disposeAssetId').value = currentAssetId;
            document.getElementById('assetDisposeForm').disposal_date.value = new Date().toISOString().split('T')[0];
            openModal('assetDisposeModal');
        }
        async function executeDispose() {
            const form = document.getElementById('assetDisposeForm');
            const data = {
                disposal_reason: form.disposal_reason.value,
                disposal_date: form.disposal_date.value,
                disposal_method: form.disposal_method.value
            };
            if (!data.disposal_reason) return alert('폐기 사유를 입력해주세요.');
            const res = await api.post(`/api/assets/${currentAssetId}/dispose`, data);
            if (res.success) {
                closeModal('assetDisposeModal');
                closeModal('assetDetailModal');
                loadAssets();
                alert(res.message);
            } else alert(res.message);
        }

        // License Detail Functions
        // - 배정 내역 탭과 시리얼키 탭을 분리 관리하고 검색/복사/엑셀 다운로드를 지원
        let currentLicenseId = null, currentLicenseMetric = null, currentLicenseKeys = [];
        function switchLicenseDetailTab(tabName) {
            document.querySelectorAll('#licenseDetailTabs .tab').forEach(tab => {
                const isActive = tab.dataset.tab === tabName;
                tab.classList.toggle('active', isActive);
                tab.setAttribute('aria-selected', isActive ? 'true' : 'false');
            });
            document.getElementById('licenseAssignmentsPanel').style.display = tabName === 'assignments' ? 'block' : 'none';
            document.getElementById('licenseKeysPanel').style.display = tabName === 'keys' ? 'block' : 'none';
        }
        function getFilteredLicenseKeys() {
            const keyword = (document.getElementById('licenseKeySearch')?.value || '').trim().toLowerCase();
            return currentLicenseKeys.filter(k => {
                if (!keyword) return true;
                const target = `${k.key_value || ''} ${k.key_status || ''} ${k.user_name || ''} ${k.employee_no || ''} ${k.asset_number || ''}`.toLowerCase();
                return target.includes(keyword);
            });
        }
        function renderLicenseKeysTable() {
            const tbody = document.getElementById('licenseKeysTable');
            if (!tbody) return;
            const filtered = getFilteredLicenseKeys();
            const total = currentLicenseKeys.length;
            const countText = document.getElementById('licenseKeyCount');
            if (countText) countText.textContent = `표시 ${filtered.length} / 전체 ${total}`;
            if (!filtered.length) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:var(--gray-500)">표시할 시리얼키가 없습니다</td></tr>';
                return;
            }
            const getKeyBadgeClass = (status) => {
                if (status === '할당') return 'badge-warning';
                if (status === '폐기') return 'badge-danger';
                return 'badge-success';
            };
            tbody.innerHTML = filtered.map(k => {
                const assignee = k.user_name ? `${k.user_name} (${k.employee_no || '-'})` : (k.asset_number || '-');
                return `<tr>
                    <td style="font-family:monospace">${k.key_value}</td>
                    <td><span class="badge ${getKeyBadgeClass(k.key_status)}">${k.key_status || '-'}</span></td>
                    <td>${assignee}</td>
                    <td>${k.assigned_date || '-'}</td>
                    <td>${k.revoked_date || '-'}</td>
                </tr>`;
            }).join('');
        }
        async function loadLicenseKeys(id) {
            const res = await api.get(`/api/licenses/${id}/keys`);
            currentLicenseKeys = res.success ? (res.data || []) : [];
            renderLicenseKeysTable();
        }
        async function copyLicenseKeys() {
            const keys = getFilteredLicenseKeys().map(k => k.key_value).filter(Boolean).join('\n');
            if (!keys) return alert('복사할 시리얼키가 없습니다.');
            try {
                await navigator.clipboard.writeText(keys);
                alert('시리얼키를 클립보드에 복사했습니다.');
            } catch (_) {
                const ta = document.createElement('textarea');
                ta.value = keys;
                document.body.appendChild(ta);
                ta.select();
                document.execCommand('copy');
                document.body.removeChild(ta);
                alert('시리얼키를 클립보드에 복사했습니다.');
            }
        }
        function exportLicenseKeysCsv() {
            const rows = getFilteredLicenseKeys();
            if (!rows.length) return alert('다운로드할 시리얼키가 없습니다.');
            const esc = (v) => `"${String(v ?? '').replace(/"/g, '""')}"`;
            const header = ['key_value', 'key_status', 'user_name', 'employee_no', 'asset_number', 'assigned_date', 'revoked_date'];
            const lines = [header.join(',')];
            rows.forEach(k => {
                lines.push([
                    esc(k.key_value), esc(k.key_status), esc(k.user_name), esc(k.employee_no),
                    esc(k.asset_number), esc(k.assigned_date), esc(k.revoked_date)
                ].join(','));
            });
            const blob = new Blob(['\ufeff' + lines.join('\n')], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `license_keys_${currentLicenseId || 'all'}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        async function openLicenseDetail(id) {
            currentLicenseId = id;
            const res = await api.get(`/api/licenses/${id}`);
            if (!res.success) return alert(res.message);
            const l = res.data;
            currentLicenseMetric = l.license_metric;
            const keyListText = l.license_key_list || l.license_key || '';
            const keyPreview = keyListText ? keyListText.split('\n').slice(0, 10).join('\n') : '-';
            document.getElementById('licenseDetailTitle').textContent = `라이선스 상세: ${l.software_name}`;
            document.getElementById('licenseDetailInfo').innerHTML = `<div class="info-grid">
                    <div class="info-item"><div class="info-label">라이선스 번호</div><div class="info-value">${l.license_number}</div></div>
                    <div class="info-item"><div class="info-label">소프트웨어</div><div class="info-value">${l.software_name}</div></div>
                    <div class="info-item"><div class="info-label">유형</div><div class="info-value">${l.license_type}</div></div>
                    <div class="info-item"><div class="info-label">측정단위</div><div class="info-value">${l.license_metric}</div></div>
                    <div class="info-item full-width">
                        <div class="info-label">시리얼키 관리</div>
                        <div class="info-value">
                            등록 ${l.key_total_count || 0} / 가용 ${l.key_available_count || 0} / 할당 ${l.key_assigned_count || 0}
                            <div style="font-family:monospace;background:var(--gray-50);padding:8px;border-radius:4px;margin-top:6px;white-space:pre-wrap">${keyPreview}</div>
                        </div>
                    </div>
                    <div class="info-item"><div class="info-label">총 수량</div><div class="info-value">${l.total_quantity}</div></div>
                    <div class="info-item"><div class="info-label">사용중</div><div class="info-value">${l.used_quantity}</div></div>
                    <div class="info-item"><div class="info-label">가용</div><div class="info-value">${l.available_quantity}</div></div>
                    <div class="info-item"><div class="info-label">상태</div>
                        <div class="info-value" style="display:flex;align-items:center;gap:8px">
                            <span class="badge ${l.compliance_status === '정상' ? 'badge-success' : 'badge-danger'}">${l.compliance_status}</span>
                            <span class="badge ${getLicenseStatusBadgeClass(l.license_status || '활성')}" id="currentLicenseStatusBadge">${l.license_status || '활성'}</span>
                            <button class="btn btn-sm btn-outline-primary" style="padding:2px 8px;font-size:12px" onclick="openLicenseStatusModal()">변경</button>
                        </div>
                    </div>
                </div>`;
            document.getElementById('licenseKeySearch').value = '';
            document.querySelectorAll('#licenseDetailTabs .tab').forEach(tab => {
                tab.onclick = () => switchLicenseDetailTab(tab.dataset.tab);
            });
            switchLicenseDetailTab('assignments');
            loadLicenseAssignmentsList(id);
            loadLicenseKeys(id);
            openModal('licenseDetailModal');
        }
        async function deleteLicense(id) {
            if (!confirm('라이선스를 삭제하시겠습니까?')) return;
            const res = await api.delete(`/api/licenses/${id}`);
            if (res.success) {
                loadLicenses();
                alert(res.message);
            } else alert(res.message);
        }
        async function loadLicenseAssignmentsList(id) {
            const res = await api.get(`/api/licenses/${id}/assignments`);
            const tbody = document.getElementById('licenseAssignmentsTable');
            if (res.success && res.data.length) {
                tbody.innerHTML = res.data.map(a => `<tr>
                        <td>${a.user_name || a.asset_number || '-'}</td>
                        <td>${a.dept_name || '-'}</td>
                        <td>${a.assigned_date || '-'}</td>
                        <td style="font-family:monospace">${a.assigned_key_value || '-'}</td>
                    <td><span class="action-group"><button class="btn btn-sm btn-action btn-action-danger" onclick="revokeLicenseAssignment(event, ${a.assignment_id})"><span class="btn-icon"><i data-lucide="undo-2" style="width:13px;height:13px"></i></span>회수</button></span></td>
                    </tr>`).join('');
            } else {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:var(--gray-500)">할당된 사용자가 없습니다</td></tr>';
            }
        }
        async function openLicenseAssignModal() {
            await loadMasterData();
            const res = await api.get(`/api/licenses/${currentLicenseId}`);
            document.getElementById('assignLicenseInfo').innerHTML = `<strong>${res.data.license_number}</strong> ${res.data.software_name}`;
            document.getElementById('assignLicenseId').value = currentLicenseId;
            document.getElementById('assignLicenseMetric').value = currentLicenseMetric;
            // Show user or asset select based on metric
            if (currentLicenseMetric === 'per_device') {
                document.getElementById('licenseUserGroup').style.display = 'none';
                document.getElementById('licenseAssetGroup').style.display = 'block';
                const assets = await api.get('/api/assets?status=사용중');
                document.getElementById('licenseAssignAssetSelect').innerHTML = assets.data.map(a => `<option value="${a.asset_id}">${a.asset_number} - ${a.asset_name}</option>`).join('');
            } else {
                document.getElementById('licenseUserGroup').style.display = 'block';
                document.getElementById('licenseAssetGroup').style.display = 'none';
                document.getElementById('licenseAssignUserSelect').innerHTML = users.filter(u => u.is_active).map(u => `<option value="${u.user_id}">${u.user_name}</option>`).join('');
            }
            openModal('licenseAssignModal');
        }
        async function editLicense(id) {
            await loadMasterData();
            const res = await api.get(`/api/licenses/${id}`);
            if (!res.success) return alert(res.message);
            const l = res.data;
            document.querySelector('#licenseModal .modal-header h3').textContent = '라이선스 수정';
            document.getElementById('licenseCategorySelect').innerHTML = categories.filter(c => c.asset_type === 'SW').map(c => `<option value="${c.category_id}">${c.category_name}</option>`).join('');
            document.getElementById('licenseManagerSelect').innerHTML = users.filter(u => u.is_active).map(u => `<option value="${u.user_id}">${u.user_name}</option>`).join('');
            const form = document.getElementById('licenseForm');
            form.reset();
            form.license_id.value = l.license_id;
            form.software_name.value = l.software_name;
            form.category_id.value = l.category_id;
            form.license_type.value = l.license_type;
            form.license_metric.value = l.license_metric;
            form.license_key.value = l.license_key_list || l.license_key || '';
            form.total_quantity.value = l.total_quantity;
            form.license_manager_id.value = l.license_manager_id;
            openModal('licenseModal');
        }
        async function executeLicenseAssign() {
            const data = getFormData('licenseAssignForm');
            const res = await api.post(`/api/licenses/${data.license_id}/assign`, data);
            if (res.success) {
                closeModal('licenseAssignModal');
                loadLicenseAssignmentsList(currentLicenseId);
                loadLicenses();
                alert(res.message);
            } else alert(res.message);
        }
        async function revokeLicenseAssignment(arg1, arg2) {
            const { evt, id: assignmentId } = getEventAndId(arg1, arg2);
            stopActionEvent(evt);
            if (!confirm('이 할당을 회수하시겠습니까?')) return;
            const res = await api.post(`/api/licenses/${currentLicenseId}/revoke`, { assignment_id: assignmentId });
            if (res.success) {
                loadLicenseAssignmentsList(currentLicenseId);
                loadLicenses();
                alert(res.message);
            } else alert(res.message);
        }

        // Locations (사업장)
        // - 검색/건물보유 필터링 + 전역 locations 캐시 갱신
        async function loadLocations() {
            const res = await api.get('/api/locations');
            if (res.success) {
                locations = res.data;
                document.getElementById('assetLocationFilter').innerHTML = '<option value="">전체 사업장</option>' + locations.map(l => `<option value="${l.location_id}">${l.location_name}</option>`).join('');
                const keyword = (document.getElementById('locationSearch')?.value || '').trim().toLowerCase();
                const buildingFilter = document.getElementById('locationBuildingFilter')?.value || '';
                const filtered = res.data.filter(l => {
                    const searchMatched = !keyword
                        || (l.location_code || '').toLowerCase().includes(keyword)
                        || (l.location_name || '').toLowerCase().includes(keyword)
                        || (l.address || '').toLowerCase().includes(keyword)
                        || (l.building || '').toLowerCase().includes(keyword);
                    const hasBuilding = Boolean((l.building || '').trim());
                    const buildingMatched = buildingFilter === 'has' ? hasBuilding
                        : buildingFilter === 'none' ? !hasBuilding
                            : true;
                    return searchMatched && buildingMatched;
                });
                document.getElementById('locationsTable').innerHTML = filtered.map((l, idx) => `<tr>
                    <td class="index-col">${idx + 1}</td>
                    <td>${l.location_code}</td><td>${l.location_name}</td><td>${l.address || ''}</td><td>${l.building || ''}</td>
                    <td>
                        <span class="action-group">
                            <button class="btn btn-sm btn-action btn-action-secondary" onclick="editLocation(${l.location_id})"><span class="btn-icon"><i data-lucide="pencil" style="width:13px;height:13px"></i></span>수정</button>
                            <button class="btn btn-sm btn-action btn-action-danger" onclick="deleteLocation(${l.location_id})"><span class="btn-icon"><i data-lucide="trash-2" style="width:13px;height:13px"></i></span>삭제</button>
                        </span>
                    </td>
                </tr>`).join('');
            }
        }
        function openLocationModal() { document.getElementById('locationForm').reset(); openModal('locationModal'); }
        async function saveLocation() {
            const data = getFormData('locationForm');
            const res = data.location_id ? await api.put(`/api/locations/${data.location_id}`, data) : await api.post('/api/locations', data);
            if (res.success) { closeModal('locationModal'); loadLocations(); alert(res.message); }
            else alert(res.message);
        }
        async function editLocation(id) {
            const res = await api.get(`/api/locations/${id}`);
            if (res.success) { openLocationModal(); Object.keys(res.data).forEach(k => { const f = document.getElementById('locationForm')[k]; if (f) f.value = res.data[k]; }); }
        }
        async function deleteLocation(id) {
            if (!confirm('사업장을 비활성화하시겠습니까?')) return;
            const res = await api.delete(`/api/locations/${id}`);
            if (res.success) {
                await loadMasterData();
                loadLocations();
                alert(res.message);
            } else alert(res.message);
        }

        // Departments (부서)
        // - 레벨/사업장 조건으로 부서 목록을 좁혀서 렌더링
        async function loadDepartments() {
            const res = await api.get('/api/departments');
            if (res.success) {
                departments = res.data;
                const locationFilterSelect = document.getElementById('departmentLocationFilter');
                if (locationFilterSelect) {
                    const selected = locationFilterSelect.value;
                    locationFilterSelect.innerHTML = '<option value="">전체 사업장</option>' + locations.map(l => `<option value="${l.location_id}">${l.location_name}</option>`).join('');
                    if (selected) locationFilterSelect.value = selected;
                }
                const keyword = (document.getElementById('departmentSearch')?.value || '').trim().toLowerCase();
                const locationFilter = document.getElementById('departmentLocationFilter')?.value || '';
                const levelFilter = document.getElementById('departmentLevelFilter')?.value || '';
                const filtered = res.data.filter(d => {
                    const searchMatched = !keyword
                        || (d.dept_code || '').toLowerCase().includes(keyword)
                        || (d.dept_name || '').toLowerCase().includes(keyword);
                    const locationMatched = !locationFilter || String(d.location_id || '') === String(locationFilter);
                    const levelMatched = !levelFilter || String(d.dept_level || '') === String(levelFilter);
                    return searchMatched && locationMatched && levelMatched;
                });
                document.getElementById('departmentsTable').innerHTML = filtered.map((d, idx) => `<tr>
                    <td class="index-col">${idx + 1}</td>
                    <td>${d.dept_code}</td><td>${d.dept_name}</td><td>${d.dept_level}</td><td>${d.location_name || ''}</td>
                    <td>
                        <span class="action-group">
                            <button class="btn btn-sm btn-action btn-action-secondary" onclick="editDept(${d.dept_id})"><span class="btn-icon"><i data-lucide="pencil" style="width:13px;height:13px"></i></span>수정</button>
                            <button class="btn btn-sm btn-action btn-action-danger" onclick="deleteDept(${d.dept_id})"><span class="btn-icon"><i data-lucide="trash-2" style="width:13px;height:13px"></i></span>삭제</button>
                        </span>
                    </td>
                </tr>`).join('');
            }
        }
        async function openDeptModal() {
            await loadMasterData();
            document.querySelector('#deptModal .modal-header h3').textContent = '부서 등록';
            document.getElementById('deptLocationSelect').innerHTML = locations.map(l => `<option value="${l.location_id}">${l.location_name}</option>`).join('');
            document.getElementById('deptForm').reset();
            document.getElementById('deptForm').dept_id.value = '';
            openModal('deptModal');
        }
        async function saveDept() {
            const data = getFormData('deptForm');
            const res = data.dept_id ? await api.put(`/api/departments/${data.dept_id}`, data) : await api.post('/api/departments', data);
            if (res.success) { closeModal('deptModal'); loadDepartments(); alert(res.message); }
            else alert(res.message);
        }
        async function editDept(id) {
            await loadMasterData();
            const res = await api.get(`/api/departments/${id}`);
            if (!res.success) return alert(res.message);
            const d = res.data;
            document.querySelector('#deptModal .modal-header h3').textContent = '부서 수정';
            document.getElementById('deptLocationSelect').innerHTML = locations.map(l => `<option value="${l.location_id}">${l.location_name}</option>`).join('');
            const form = document.getElementById('deptForm');
            form.reset();
            form.dept_id.value = d.dept_id;
            form.dept_code.value = d.dept_code;
            form.dept_name.value = d.dept_name;
            form.dept_level.value = d.dept_level;
            form.location_id.value = d.location_id;
            openModal('deptModal');
        }
        async function deleteDept(id) {
            if (!confirm('부서를 비활성화하시겠습니까?')) return;
            const res = await api.delete(`/api/departments/${id}`);
            if (res.success) {
                await loadMasterData();
                loadDepartments();
                alert(res.message);
            } else alert(res.message);
        }

        // Users (사용자)
        // - 사번/이름/이메일 검색 + 사업장/재직 상태 필터
        async function loadUsers() {
            const res = await api.get('/api/users');
            if (res.success) {
                users = res.data;
                const locationFilterSelect = document.getElementById('userLocationFilter');
                if (locationFilterSelect) {
                    const selected = locationFilterSelect.value;
                    locationFilterSelect.innerHTML = '<option value="">전체 사업장</option>' + locations.map(l => `<option value="${l.location_id}">${l.location_name}</option>`).join('');
                    if (selected) locationFilterSelect.value = selected;
                }
                const keyword = (document.getElementById('userSearch')?.value || '').trim().toLowerCase();
                const locationFilter = document.getElementById('userLocationFilter')?.value || '';
                const statusFilter = document.getElementById('userStatusFilter')?.value || '';
                const filtered = res.data.filter(u => {
                    const searchMatched = !keyword
                        || (u.employee_no || '').toLowerCase().includes(keyword)
                        || (u.user_name || '').toLowerCase().includes(keyword)
                        || (u.email || '').toLowerCase().includes(keyword);
                    const locationMatched = !locationFilter || String(u.location_id || '') === String(locationFilter);
                    const isActive = Boolean(u.is_active);
                    const statusMatched = statusFilter === 'active' ? isActive
                        : statusFilter === 'inactive' ? !isActive
                            : true;
                    return searchMatched && locationMatched && statusMatched;
                });
                document.getElementById('usersTable').innerHTML = filtered.map((u, idx) => `<tr>
                    <td class="index-col">${idx + 1}</td>
                    <td>${u.employee_no}</td><td>${u.user_name}</td><td>${u.email}</td><td>${u.dept_name || ''}</td><td>${u.location_name || ''}</td>
                    <td><span class="badge ${u.is_active ? 'badge-success' : 'badge-danger'}">${u.is_active ? '재직' : '퇴직'}</span></td>
                    <td>
                        <span class="action-group">
                            <button class="btn btn-sm btn-action btn-action-secondary" onclick="editUser(event, ${u.user_id})"><span class="btn-icon"><i data-lucide="pencil" style="width:13px;height:13px"></i></span>수정</button>
                            <button class="btn btn-sm btn-action btn-action-primary" onclick="viewUserDetail(event, ${u.user_id})"><span class="btn-icon"><i data-lucide="user" style="width:13px;height:13px"></i></span>상세</button>
                            ${u.is_active ? `<button class="btn btn-sm btn-action btn-action-danger" onclick="bulkReturn(event, ${u.user_id})"><span class="btn-icon"><i data-lucide="undo-2" style="width:13px;height:13px"></i></span>일괄회수</button>` : ''}
                        </span>
                    </td>
                </tr>`).join('');
            }
        }
        async function openUserModal() {
            await loadMasterData();
            document.querySelector('#userModal .modal-header h3').textContent = '사용자 등록';
            document.getElementById('userDeptSelect').innerHTML = departments.map(d => `<option value="${d.dept_id}">${d.dept_name}</option>`).join('');
            document.getElementById('userLocationSelect').innerHTML = locations.map(l => `<option value="${l.location_id}">${l.location_name}</option>`).join('');
            document.getElementById('userForm').reset();
            document.getElementById('userForm').user_id.value = '';
            openModal('userModal');
        }
        async function saveUser() {
            const data = getFormData('userForm');
            const res = data.user_id ? await api.put(`/api/users/${data.user_id}`, data) : await api.post('/api/users', data);
            if (res.success) { closeModal('userModal'); loadUsers(); alert(res.message); }
            else alert(res.message);
        }
        async function editUser(arg1, arg2) {
            const { evt, id } = getEventAndId(arg1, arg2);
            stopActionEvent(evt);
            await loadMasterData();
            const res = await api.get(`/api/users/${id}`);
            if (!res.success) return alert(res.message);
            const u = res.data;
            document.querySelector('#userModal .modal-header h3').textContent = '사용자 수정';
            document.getElementById('userDeptSelect').innerHTML = departments.map(d => `<option value="${d.dept_id}">${d.dept_name}</option>`).join('');
            document.getElementById('userLocationSelect').innerHTML = locations.map(l => `<option value="${l.location_id}">${l.location_name}</option>`).join('');
            const form = document.getElementById('userForm');
            form.reset();
            form.user_id.value = u.user_id;
            form.employee_no.value = u.employee_no;
            form.user_name.value = u.user_name;
            form.email.value = u.email || '';
            form.dept_id.value = u.dept_id;
            form.location_id.value = u.location_id;
            openModal('userModal');
        }
        async function viewUserDetail(arg1, arg2) {
            const { evt, id } = getEventAndId(arg1, arg2);
            stopActionEvent(evt);
            const [user, assets, licenses] = await Promise.all([
                api.get(`/api/users/${id}`),
                api.get(`/api/users/${id}/assets`),
                api.get(`/api/users/${id}/licenses`)
            ]);
            if (!user.success) return alert(user.message || '사용자 정보를 불러오지 못했습니다.');
            const userInfo = user.data;
            const assetCount = assets.success ? (assets.data?.length || 0) : 0;
            const licenseCount = licenses.success ? (licenses.data?.length || 0) : 0;
            const assetRows = assets.success && assets.data?.length
                ? assets.data.slice(0, 10).map(a => `<tr><td>${a.asset_number}</td><td>${a.asset_name}</td><td>${a.category_name || '-'}</td></tr>`).join('')
                : '<tr><td colspan="3" style="text-align:center;color:var(--gray-500)">배정 자산 없음</td></tr>';
            const licenseRows = licenses.success && licenses.data?.length
                ? licenses.data.slice(0, 10).map(l => `<tr><td>${l.license_number}</td><td>${l.software_name}</td><td>${l.assigned_date || '-'}</td></tr>`).join('')
                : '<tr><td colspan="3" style="text-align:center;color:var(--gray-500)">할당 라이선스 없음</td></tr>';

            document.getElementById('userDetailTitle').textContent = `사용자 상세 - ${userInfo.user_name}`;
            document.getElementById('userDetailContent').innerHTML = `
                <div style="background:var(--gray-100);padding:12px 14px;border-radius:10px;margin-bottom:16px">
                    <strong>${userInfo.user_name}</strong> (${userInfo.employee_no})<br>
                    이메일: ${userInfo.email || '-'}<br>
                    부서/사업장: ${userInfo.dept_name || '-'} / ${userInfo.location_name || '-'}<br>
                    상태: ${userInfo.is_active ? '재직' : '퇴직'}
                </div>
                <div class="chart-title">배정 자산 (${assetCount})</div>
                <div class="table-container" style="box-shadow:none;border:1px solid var(--gray-200);margin-bottom:16px">
                    <table>
                        <thead><tr><th>자산번호</th><th>자산명</th><th>카테고리</th></tr></thead>
                        <tbody>${assetRows}</tbody>
                    </table>
                </div>
                <div class="chart-title">할당 라이선스 (${licenseCount})</div>
                <div class="table-container" style="box-shadow:none;border:1px solid var(--gray-200)">
                    <table>
                        <thead><tr><th>라이선스번호</th><th>소프트웨어명</th><th>할당일</th></tr></thead>
                        <tbody>${licenseRows}</tbody>
                    </table>
                </div>
            `;
            openModal('userDetailModal');
        }
        async function bulkReturn(arg1, arg2) {
            const { evt, id } = getEventAndId(arg1, arg2);
            stopActionEvent(evt);
            if (confirm('이 사용자의 모든 자산과 라이선스를 회수합니다.')) {
                const res = await api.post(`/api/users/${id}/bulk-return`, {});
                alert(res.message);
                loadUsers();
            }
        }

        // Categories (카테고리)
        // - 유형(HW/SW)과 레벨로 검색 조건 분기 + 계층 표시(레벨에 따른 들여쓰기)
        async function loadCategories() {
            const res = await api.get('/api/categories');
            if (res.success) {
                categories = res.data;
                const keyword = (document.getElementById('categorySearch')?.value || '').trim().toLowerCase();
                const typeFilter = document.getElementById('categoryTypeFilter')?.value || '';
                const levelFilter = document.getElementById('categoryLevelFilter')?.value || '';
                const filtered = res.data.filter(c => {
                    const searchMatched = !keyword
                        || (c.category_code || '').toLowerCase().includes(keyword)
                        || (c.category_name || '').toLowerCase().includes(keyword);
                    const typeMatched = !typeFilter || c.asset_type === typeFilter;
                    const levelMatched = !levelFilter || String(c.category_level || '') === String(levelFilter);
                    return searchMatched && typeMatched && levelMatched;
                });
                document.getElementById('categoriesTable').innerHTML = filtered.map((c, idx) => {
                    const parent = categories.find(p => p.category_id === c.parent_category_id);
                    return `<tr>
                    <td class="index-col">${idx + 1}</td><td>${c.category_code}</td><td>${'　'.repeat(c.category_level - 1)}${c.category_name}</td>
                    <td>${c.category_level}</td><td>${c.asset_type}</td><td>${parent ? parent.category_name : '-'}</td><td>${c.useful_life_months || '-'}</td>
                    <td>
                        <span class="action-group">
                            <button class="btn btn-sm btn-action btn-action-secondary" onclick="editCategory(${c.category_id})"><span class="btn-icon"><i data-lucide="pencil" style="width:13px;height:13px"></i></span>수정</button>
                            <button class="btn btn-sm btn-action btn-action-danger" onclick="deleteCategory(${c.category_id})"><span class="btn-icon"><i data-lucide="trash-2" style="width:13px;height:13px"></i></span>삭제</button>
                        </span>
                    </td>
                </tr>`;
                }).join('');
            }
        }
        function openCategoryModal() {
            document.getElementById('categoryModalTitle').textContent = '카테고리 등록';
            document.getElementById('categoryForm').reset();
            document.getElementById('categoryId').value = '';
            updateParentCategoryOptions(3);
            openModal('categoryModal');
        }
        function updateParentCategoryOptions(level) {
            const parentLevel = parseInt(level) - 1;
            const sel = document.getElementById('parentCategorySelect');
            if (parentLevel < 1) {
                document.getElementById('parentCategoryGroup').style.display = 'none';
                sel.innerHTML = '<option value="">없음</option>';
            } else {
                document.getElementById('parentCategoryGroup').style.display = 'block';
                const opts = categories.filter(c => c.category_level === parentLevel);
                sel.innerHTML = '<option value="">선택</option>' + opts.map(c => `<option value="${c.category_id}">${c.category_name}</option>`).join('');
            }
        }
        async function editCategory(id) {
            const res = await api.get(`/api/categories/${id}`);
            if (!res.success) return alert(res.message);
            const c = res.data;
            document.getElementById('categoryModalTitle').textContent = '카테고리 수정';
            document.getElementById('categoryId').value = c.category_id;
            const form = document.getElementById('categoryForm');
            form.category_code.value = c.category_code;
            form.category_name.value = c.category_name;
            form.category_level.value = c.category_level;
            form.asset_type.value = c.asset_type;
            form.useful_life_months.value = c.useful_life_months || '';
            updateParentCategoryOptions(c.category_level);
            form.parent_category_id.value = c.parent_category_id || '';
            openModal('categoryModal');
        }
        async function saveCategory() {
            const form = document.getElementById('categoryForm');
            const data = {
                category_code: form.category_code.value,
                category_name: form.category_name.value,
                category_level: parseInt(form.category_level.value),
                asset_type: form.asset_type.value,
                parent_category_id: form.parent_category_id.value ? parseInt(form.parent_category_id.value) : null,
                useful_life_months: form.useful_life_months.value ? parseInt(form.useful_life_months.value) : null
            };
            const id = document.getElementById('categoryId').value;
            const res = id ? await api.put(`/api/categories/${id}`, data) : await api.post('/api/categories', data);
            if (res.success) { closeModal('categoryModal'); loadCategories(); alert(res.message); }
            else alert(res.message);
        }
        async function deleteCategory(id) {
            if (!confirm('카테고리를 비활성화하시겠습니까?')) return;
            const res = await api.delete(`/api/categories/${id}`);
            if (res.success) {
                await loadMasterData();
                loadCategories();
                alert(res.message);
            } else alert(res.message);
        }

        // Vendors (공급업체)
        // - 키워드 및 유형 필터로 목록 축소, 라이선스 공급사 select 옵션도 동기화
        async function loadVendors() {
            const res = await api.get('/api/vendors');
            if (res.success) {
                vendors = res.data;
                const keyword = (document.getElementById('vendorSearch')?.value || '').trim().toLowerCase();
                const typeFilter = document.getElementById('vendorTypeFilter')?.value || '';
                const filtered = res.data.filter(v => {
                    const searchMatched = !keyword
                        || (v.vendor_name || '').toLowerCase().includes(keyword)
                        || (v.contact_name || '').toLowerCase().includes(keyword)
                        || (v.contact_phone || '').toLowerCase().includes(keyword)
                        || (v.contact_email || '').toLowerCase().includes(keyword);
                    const typeMatched = !typeFilter || v.vendor_type === typeFilter;
                    return searchMatched && typeMatched;
                });
                document.getElementById('vendorsTable').innerHTML = filtered.map((v, idx) => `<tr>
                    <td class="index-col">${idx + 1}</td><td>${v.vendor_name}</td><td>${v.vendor_type}</td><td>${v.contact_name || ''}</td>
                    <td>${v.contact_phone || ''}</td><td>${v.contact_email || ''}</td>
                    <td>
                        <span class="action-group">
                            <button class="btn btn-sm btn-action btn-action-secondary" onclick="editVendor(${v.vendor_id})"><span class="btn-icon"><i data-lucide="pencil" style="width:13px;height:13px"></i></span>수정</button>
                            <button class="btn btn-sm btn-action btn-action-danger" onclick="deleteVendor(${v.vendor_id})"><span class="btn-icon"><i data-lucide="trash-2" style="width:13px;height:13px"></i></span>삭제</button>
                        </span>
                    </td>
                </tr>`).join('');
                renderLicenseVendorFilter();
            }
        }
        function openVendorModal() {
            document.querySelector('#vendorModal .modal-header h3').textContent = '공급업체 등록';
            document.getElementById('vendorForm').reset();
            document.getElementById('vendorForm').vendor_id.value = '';
            openModal('vendorModal');
        }
        async function saveVendor() {
            const data = getFormData('vendorForm');
            const res = data.vendor_id ? await api.put(`/api/vendors/${data.vendor_id}`, data) : await api.post('/api/vendors', data);
            if (res.success) { closeModal('vendorModal'); loadVendors(); alert(res.message); }
            else alert(res.message);
        }
        function editVendor(id) {
            const v = vendors.find(item => item.vendor_id === id);
            if (!v) return alert('공급업체 정보를 찾을 수 없습니다.');
            document.querySelector('#vendorModal .modal-header h3').textContent = '공급업체 수정';
            const form = document.getElementById('vendorForm');
            form.reset();
            form.vendor_id.value = v.vendor_id;
            form.vendor_name.value = v.vendor_name;
            form.vendor_type.value = v.vendor_type;
            form.contact_name.value = v.contact_name || '';
            form.contact_phone.value = v.contact_phone || '';
            form.contact_email.value = v.contact_email || '';
            openModal('vendorModal');
        }
        async function deleteVendor(id) {
            if (!confirm('공급업체를 비활성화하시겠습니까?')) return;
            const res = await api.delete(`/api/vendors/${id}`);
            if (res.success) {
                loadVendors();
                alert(res.message);
            } else alert(res.message);
        }

        // EOS 정보
        // - 제품 검색 + 유형 select 동적 갱신 + EOS 만료 상태 시각 강조
        async function loadEOS() {
            const res = await api.get('/api/eos-info');
            if (res.success) {
                eosInfos = res.data;
                const typeFilterSelect = document.getElementById('eosTypeFilter');
                if (typeFilterSelect) {
                    const selected = typeFilterSelect.value;
                    const types = [...new Set(eosInfos.map(e => e.product_type).filter(Boolean))];
                    typeFilterSelect.innerHTML = '<option value="">전체 유형</option>' + types.map(t => `<option value="${t}">${t}</option>`).join('');
                    if (selected) typeFilterSelect.value = selected;
                }
                const keyword = (document.getElementById('eosSearch')?.value || '').trim().toLowerCase();
                const typeFilter = document.getElementById('eosTypeFilter')?.value || '';
                const filtered = eosInfos.filter(e => {
                    const searchMatched = !keyword
                        || (e.product_name || '').toLowerCase().includes(keyword)
                        || (e.product_version || '').toLowerCase().includes(keyword)
                        || (e.vendor || '').toLowerCase().includes(keyword);
                    const typeMatched = !typeFilter || e.product_type === typeFilter;
                    return searchMatched && typeMatched;
                });
                document.getElementById('eosTable').innerHTML = filtered.map((e, idx) => `<tr>
                    <td class="index-col">${idx + 1}</td><td>${e.product_name}</td><td>${e.product_version || ''}</td><td>${e.product_type}</td><td>${e.vendor || ''}</td>
                    <td><span class="badge ${new Date(e.eos_date) < new Date() ? 'badge-danger' : 'badge-info'}">${e.eos_date}</span></td>
                    <td>${e.notes || ''}</td>
                    <td>
                        <span class="action-group">
                            <button class="btn btn-sm btn-action btn-action-secondary" onclick="editEOS(${e.eos_id})"><span class="btn-icon"><i data-lucide="pencil" style="width:13px;height:13px"></i></span>수정</button>
                            <button class="btn btn-sm btn-action btn-action-danger" onclick="deleteEOS(${e.eos_id})"><span class="btn-icon"><i data-lucide="trash-2" style="width:13px;height:13px"></i></span>삭제</button>
                        </span>
                    </td>
                </tr>`).join('');
            }
        }
        function openEOSModal() {
            document.getElementById('eosModalTitle').textContent = 'EOS 정보 등록';
            document.getElementById('eosForm').reset();
            document.getElementById('eosId').value = '';
            openModal('eosModal');
        }
        async function editEOS(id) {
            const res = await api.get(`/api/eos-info/${id}`);
            if (!res.success) return alert(res.message);
            const e = res.data;
            document.getElementById('eosModalTitle').textContent = 'EOS 정보 수정';
            document.getElementById('eosId').value = e.eos_id;
            const form = document.getElementById('eosForm');
            form.product_name.value = e.product_name;
            form.product_version.value = e.product_version || '';
            form.eos_type.value = e.product_type;
            form.manufacturer.value = e.vendor || '';
            form.eos_date.value = e.eos_date;
            form.notes.value = e.notes || '';
            openModal('eosModal');
        }
        async function saveEOS() {
            const form = document.getElementById('eosForm');
            const data = {
                product_name: form.product_name.value,
                product_version: form.product_version.value,
                product_type: form.eos_type.value,
                vendor: form.manufacturer.value,
                eos_date: form.eos_date.value,
                notes: form.notes.value
            };
            const id = document.getElementById('eosId').value;
            const res = id ? await api.put(`/api/eos-info/${id}`, data) : await api.post('/api/eos-info', data);
            if (res.success) { closeModal('eosModal'); loadEOS(); alert(res.message); }
            else alert(res.message);
        }
        async function deleteEOS(id) {
            if (!confirm('EOS 정보를 삭제하시겠습니까?')) return;
            const res = await api.delete(`/api/eos-info/${id}`);
            if (res.success) {
                loadEOS();
                alert(res.message);
            } else alert(res.message);
        }

        // Inventories (실사 관리)
        // - 실사 일정과 상태를 조회만 하는 가벼운 리스트 영역
        async function loadInventories() {
            const res = await api.get('/api/inventories');
            if (res.success) {
                document.getElementById('inventoriesTable').innerHTML = res.data.map(i => `<tr>
                    <td>${i.schedule_name}</td><td>${i.schedule_type}</td><td>${i.start_date} ~ ${i.end_date}</td>
                    <td>${i.manager_name || ''}</td>
                    <td><span class="badge ${i.status === '완료' ? 'badge-success' : i.status === '진행중' ? 'badge-warning' : 'badge-info'}">${i.status}</span></td>
                </tr>`).join('');
            }
        }
        async function openInventoryModal() {
            await loadMasterData();
            document.getElementById('inventoryManagerSelect').innerHTML = users.filter(u => u.is_active).map(u => `<option value="${u.user_id}">${u.user_name}</option>`).join('');
            document.getElementById('inventoryForm').reset();
            openModal('inventoryModal');
        }
        async function saveInventory() {
            const data = getFormData('inventoryForm');
            data.status = '예정';
            const res = await api.post('/api/inventories', data);
            if (res.success) { closeModal('inventoryModal'); loadInventories(); alert(res.message); }
            else alert(res.message);
        }

        // Import/Export Functions
        // - 템플릿 다운로드, 파일 업로드, 대량 내보내기를 통합된 흐름으로 관리
        function downloadTemplate(type) {
            const url = type === 'license' ? '/api/licenses/import-template' : `/api/assets/import-template/${type}`;
            window.location.href = url;
        }
        function openImportModal(type) {
            document.getElementById('importType').value = type;
            document.getElementById('importFile').value = '';
            document.getElementById('importResult').innerHTML = '';
            openModal('importModal');
        }
        async function executeImport() {
            const type = document.getElementById('importType').value;
            const file = document.getElementById('importFile').files[0];
            if (!file) { alert('파일을 선택해주세요.'); return; }
            const formData = new FormData();
            formData.append('file', file);
            const url = type === 'license' ? '/api/licenses/import' : '/api/assets/import';
            const res = await fetch(url, { method: 'POST', body: formData }).then(r => r.json());
            if (res.success) {
                let html = `<div class="badge badge-success"><i data-lucide="check-circle-2" style="width:13px;height:13px;display:inline-block;vertical-align:middle;margin-right:3px"></i> 성공: ${res.data.success}건</div>`;
                if (res.data.errors?.length) {
                    html += `<div class="badge badge-danger" style="margin-left:8px"><i data-lucide="x-circle" style="width:13px;height:13px;display:inline-block;vertical-align:middle;margin-right:3px"></i> 실패: ${res.data.errors.length}건</div>`;
                    html += '<ul style="margin-top:12px;font-size:0.875rem">';
                    res.data.errors.slice(0, 5).forEach(e => {
                        html += `<li>행 ${e.row}: ${e.errors.join(', ')}</li>`;
                    });
                    html += '</ul>';
                }
                document.getElementById('importResult').innerHTML = html;
                if (type === 'asset') loadAssets();
                else loadLicenses();
            } else {
                document.getElementById('importResult').innerHTML = `<div class="badge badge-danger"><i data-lucide="x-circle" style="width:13px;height:13px;display:inline-block;vertical-align:middle;margin-right:3px"></i> 오류: ${res.message}</div>`;
            }
        }
        function exportAssets() { window.location.href = '/api/assets/export'; }
        function exportLicenses() { window.location.href = '/api/licenses/export'; }

        // Notifications
        // - 알림 목록 조회 + 읽음 처리 API 호출로 상태 반영
        async function loadNotifications() {
            const res = await api.get('/api/notifications');
            document.getElementById('notificationsList').innerHTML = res.success && res.data.length ?
                res.data.map(n => `<div class="activity-item" style="opacity:${n.is_read ? 0.6 : 1}">
                    <div style="display:flex;justify-content:space-between">
                        <strong>${n.title}</strong>
                        <span class="badge ${n.severity === 'critical' ? 'badge-danger' : n.severity === 'warning' ? 'badge-warning' : 'badge-info'}">${n.severity}</span>
                    </div>
                    <div class="activity-text">${n.message}</div>
                    <div class="activity-time">${n.created_at}</div>
                </div>`).join('') : '<p style="color:var(--gray-600)">알림이 없습니다.</p>';
        }
        async function readAllNotifications() {
            await api.post('/api/notifications/read-all', {});
            loadNotifications();
        }

        // Load Master Data
        // - 기준정보(사업장/부서/사용자/카테고리/공급업체)를 병렬 조회해 전역 캐시를 채움
        async function loadMasterData() {
            const [loc, dept, usr, cat, ven] = await Promise.all([
                api.get('/api/locations'), api.get('/api/departments'), api.get('/api/users'), api.get('/api/categories'), api.get('/api/vendors')
            ]);
            if (loc.success) locations = loc.data;
            if (dept.success) departments = dept.data;
            if (usr.success) users = usr.data;
            if (cat.success) categories = cat.data;
            if (ven.success) {
                vendors = ven.data;
                renderLicenseVendorFilter();
            }
        }

        function renderLicenseVendorFilter() {
            const select = document.getElementById('licenseVendorFilter');
            if (!select || !vendors.length) return;
            const selected = select.value;
            select.innerHTML = '<option value="">전체 공급사</option>' + vendors.map(v => `<option value="${v.vendor_id}">${v.vendor_name}</option>`).join('');
            if (selected) select.value = selected;
        }

        // Init
        // - 앱 진입 시 날짜 배치 + 필수 데이터/기본 페이지 로드 순서 설정
        function displayCurrentDate() {
            const dateElement = document.getElementById('currentDate');
            if (!dateElement) return;

            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth() + 1;
            const date = now.getDate();
            const days = ['일', '월', '화', '수', '목', '금', '토'];
            const dayName = days[now.getDay()];

            dateElement.textContent = `${year}년 ${month}월 ${date}일 (${dayName})`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            displayCurrentDate();
            loadMasterData().then(() => {
                loadDashboard();
                loadLocations();
            });
        });
    </script>
</body>

</html>